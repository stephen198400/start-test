import{j as l,B as C,r as P,l as xr,t as lt}from"./client-Cvap-9nx.js";import{T as Dr,L as de,S as Ct,a as Lt,b as jt,c as Pt,e as Nr,f as Cr,B as Me,h as Lr,N as f,D as jr,E as Pr,F as $r,G as Vr,H as Hr,J as zr,I as Te,O as Wr,P as Mr,Q as Kr,R as qr,U as Ne,K as Jr,M as Br,z as ut,u as Fr,s as Zr,t as Gr,v as Qr,w as Yr,x as Xr,y as es,A as ts,C as rs,g as ss,i as ns,j as os,k as Ce,l as is,m as ft,n as as,o as ht,d as cs,p as ds,q as ls,r as us}from"./tabs-BhZ2xpi3.js";import{n as fs,S as hs,s as Le,t as je,E as ps,v as Pe,z as _e,x as ms,J as gs,B as ws}from"./index-B4q7z6bZ.js";import{c as ys,X as pt}from"./capitalizeFirstLetter-Cw5ycAQ_.js";import{c as $t}from"./createLucideIcon-B4z-Guh5.js";import{q as bs,s as Es,L as Ss,u as _s}from"./supabase-AYwFb2yR.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}],["path",{d:"M14.05 2a9 9 0 0 1 8 7.94",key:"vmijpz"}],["path",{d:"M14.05 6A5 5 0 0 1 18 10",key:"13nbpp"}]],Ts=$t("phone-call",As);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],Rs=$t("search",ks);function vs({tabs:e,defaultTab:t}){const r=t||e[0]?.value||"outline";return l.jsxs(Dr,{defaultValue:r,className:"w-full flex-col justify-start gap-6",children:[l.jsxs("div",{className:"flex items-center justify-between px-4 lg:px-6",children:[l.jsx(de,{htmlFor:"view-selector",className:"sr-only",children:"View"}),l.jsxs(Ct,{defaultValue:r,children:[l.jsx(Lt,{className:"flex w-fit @4xl/main:hidden cursor-pointer",size:"sm",id:"view-selector",children:l.jsx(jt,{placeholder:"Select a view"})}),l.jsx(Pt,{})]}),l.jsx(Nr,{className:"**:data-[slot=badge]:bg-muted-foreground/30 hidden **:data-[slot=badge]:size-5 **:data-[slot=badge]:rounded-full **:data-[slot=badge]:px-1 @4xl/main:flex",children:e.map(s=>l.jsxs(Cr,{value:s.value,className:"cursor-pointer",children:[s.label,s.badgeCount?l.jsx(Me,{variant:"secondary",children:s.badgeCount}):null]},s.value))}),l.jsx("div",{className:"w-40"})]}),e.map(s=>l.jsx(Lr,{value:s.value,className:"relative flex flex-col gap-4 overflow-auto px-4 lg:px-6",children:s.content},s.value))]})}const Vt=globalThis.crypto,se=Vt.subtle,Is=e=>Vt.getRandomValues(e);var Us={OK:200,CREATED:201,ACCEPTED:202,NO_CONTENT:204,MULTIPLE_CHOICES:300,MOVED_PERMANENTLY:301,FOUND:302,SEE_OTHER:303,NOT_MODIFIED:304,TEMPORARY_REDIRECT:307,BAD_REQUEST:400,UNAUTHORIZED:401,PAYMENT_REQUIRED:402,FORBIDDEN:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,NOT_ACCEPTABLE:406,PROXY_AUTHENTICATION_REQUIRED:407,REQUEST_TIMEOUT:408,CONFLICT:409,GONE:410,LENGTH_REQUIRED:411,PRECONDITION_FAILED:412,PAYLOAD_TOO_LARGE:413,URI_TOO_LONG:414,UNSUPPORTED_MEDIA_TYPE:415,RANGE_NOT_SATISFIABLE:416,EXPECTATION_FAILED:417,"I'M_A_TEAPOT":418,MISDIRECTED_REQUEST:421,UNPROCESSABLE_ENTITY:422,LOCKED:423,FAILED_DEPENDENCY:424,TOO_EARLY:425,UPGRADE_REQUIRED:426,PRECONDITION_REQUIRED:428,TOO_MANY_REQUESTS:429,REQUEST_HEADER_FIELDS_TOO_LARGE:431,UNAVAILABLE_FOR_LEGAL_REASONS:451,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,HTTP_VERSION_NOT_SUPPORTED:505,VARIANT_ALSO_NEGOTIATES:506,INSUFFICIENT_STORAGE:507,LOOP_DETECTED:508,NOT_EXTENDED:510,NETWORK_AUTHENTICATION_REQUIRED:511},p=class extends Error{constructor(e="INTERNAL_SERVER_ERROR",t=void 0,r={},s=typeof e=="number"?e:Us[e]){super(t?.message),this.status=e,this.body=t,this.headers=r,this.statusCode=s,this.name="APIError",this.status=e,this.headers=r,this.statusCode=s,this.body=t?{code:t?.message?.toUpperCase().replace(/ /g,"_").replace(/[^A-Z0-9_]/g,""),...t}:void 0,this.stack=""}};function Ht(e){return e instanceof p||e?.name==="APIError"}function Os(e){try{return e.includes("%")?decodeURIComponent(e):e}catch{return e}}function xs(e){if(e===void 0)return!1;const t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}function Ke(e,t){if(e instanceof Response)return t?.headers instanceof Headers&&t.headers.forEach((n,o)=>{e.headers.set(o,n)}),e;if(e?._flag==="json"){const n=e.routerResponse;return n instanceof Response?n:Ke(e.body,{headers:e.headers,status:e.status})}if(Ht(e))return Ke(e.body,{status:e.statusCode,statusText:e.status.toString(),headers:t?.headers||e.headers});let r=e,s=new Headers(t?.headers);return e?typeof e=="string"?(r=e,s.set("Content-Type","text/plain")):e instanceof ArrayBuffer||ArrayBuffer.isView(e)?(r=e,s.set("Content-Type","application/octet-stream")):e instanceof Blob?(r=e,s.set("Content-Type",e.type||"application/octet-stream")):e instanceof FormData?r=e:e instanceof URLSearchParams?(r=e,s.set("Content-Type","application/x-www-form-urlencoded")):e instanceof ReadableStream?(r=e,s.set("Content-Type","application/octet-stream")):xs(e)&&(r=JSON.stringify(e),s.set("Content-Type","application/json")):s.set("content-type","application/json"),new Response(r,{...t,headers:s})}async function Ds(e,t={}){let r={body:t.body,query:t.query};if(e.body){const s=await e.body["~standard"].validate(t.body);if(s.issues)return{data:null,error:mt(s.issues,"body")};r.body=s.value}if(e.query){const s=await e.query["~standard"].validate(t.query);if(s.issues)return{data:null,error:mt(s.issues,"query")};r.query=s.value}return e.requireHeaders&&!t.headers?{data:null,error:{message:"Headers is required"}}:e.requireRequest&&!t.request?{data:null,error:{message:"Request is required"}}:{data:r,error:null}}function mt(e,t){for(const r of e)r.message;return{message:`Invalid ${t} parameters`}}var et={name:"HMAC",hash:"SHA-256"},zt=async e=>{const t=typeof e=="string"?new TextEncoder().encode(e):e;return await se.importKey("raw",t,et,!1,["sign","verify"])},Ns=async(e,t,r)=>{try{const s=atob(e),n=new Uint8Array(s.length);for(let o=0,i=s.length;o<i;o++)n[o]=s.charCodeAt(o);return await se.verify(et,r,n,new TextEncoder().encode(t))}catch{return!1}},Cs=async(e,t)=>{const r=await zt(t),s=await se.sign(et.name,r,new TextEncoder().encode(e));return btoa(String.fromCharCode(...new Uint8Array(s)))},Ls=async(e,t)=>{const r=await Cs(e,t);return e=`${e}.${r}`,e=encodeURIComponent(e),e},gt=(e,t)=>{let r=e;if(t)if(t==="secure")r="__Secure-"+e;else if(t==="host")r="__Host-"+e;else return;return r};function js(e){if(typeof e!="string")throw new TypeError("argument str must be a string");const t=new Map;let r=0;for(;r<e.length;){const s=e.indexOf("=",r);if(s===-1)break;let n=e.indexOf(";",r);if(n===-1)n=e.length;else if(n<s){r=e.lastIndexOf(";",s-1)+1;continue}const o=e.slice(r,s).trim();if(!t.has(o)){let i=e.slice(s+1,n).trim();i.codePointAt(0)===34&&(i=i.slice(1,-1)),t.set(o,Os(i))}r=n+1}return t}var Wt=(e,t,r={})=>{let s;if(r?.prefix==="secure"?s=`${`__Secure-${e}`}=${t}`:r?.prefix==="host"?s=`${`__Host-${e}`}=${t}`:s=`${e}=${t}`,e.startsWith("__Secure-")&&!r.secure&&(r.secure=!0),e.startsWith("__Host-")&&(r.secure||(r.secure=!0),r.path!=="/"&&(r.path="/"),r.domain&&(r.domain=void 0)),r&&typeof r.maxAge=="number"&&r.maxAge>=0){if(r.maxAge>3456e4)throw new Error("Cookies Max-Age SHOULD NOT be greater than 400 days (34560000 seconds) in duration.");s+=`; Max-Age=${Math.floor(r.maxAge)}`}if(r.domain&&r.prefix!=="host"&&(s+=`; Domain=${r.domain}`),r.path&&(s+=`; Path=${r.path}`),r.expires){if(r.expires.getTime()-Date.now()>3456e7)throw new Error("Cookies Expires SHOULD NOT be greater than 400 days (34560000 seconds) in the future.");s+=`; Expires=${r.expires.toUTCString()}`}return r.httpOnly&&(s+="; HttpOnly"),r.secure&&(s+="; Secure"),r.sameSite&&(s+=`; SameSite=${r.sameSite.charAt(0).toUpperCase()+r.sameSite.slice(1)}`),r.partitioned&&(r.secure||(r.secure=!0),s+="; Partitioned"),s},Ps=(e,t,r)=>(t=encodeURIComponent(t),Wt(e,t,r)),$s=async(e,t,r,s)=>(t=await Ls(t,r),Wt(e,t,s)),Mt=async(e,{options:t,path:r})=>{const s=new Headers,{data:n,error:o}=await Ds(t,e);if(o)throw new p(400,{message:o.message,code:"VALIDATION_ERROR"});const i="headers"in e?e.headers instanceof Headers?e.headers:new Headers(e.headers):"request"in e&&e.request instanceof Request?e.request.headers:null,a=i?.get("cookie"),d=a?js(a):void 0,c={...e,body:n.body,query:n.query,path:e.path||r,context:"context"in e&&e.context?e.context:{},returned:void 0,headers:e?.headers,request:e?.request,params:"params"in e?e.params:void 0,method:e.method,setHeader:(u,h)=>{s.set(u,h)},getHeader:u=>i?i.get(u):null,getCookie:(u,h)=>{const m=gt(u,h);return m&&d?.get(m)||null},getSignedCookie:async(u,h,m)=>{const y=gt(u,m);if(!y)return null;const b=d?.get(y);if(!b)return null;const A=b.lastIndexOf(".");if(A<1)return null;const I=b.substring(0,A),E=b.substring(A+1);if(E.length!==44||!E.endsWith("="))return null;const T=await zt(h);return await Ns(E,I,T)?I:!1},setCookie:(u,h,m)=>{const y=Ps(u,h,m);return s.append("set-cookie",y),y},setSignedCookie:async(u,h,m,y)=>{const b=await $s(u,h,m,y);return s.append("set-cookie",b),b},redirect:u=>(s.set("location",u),new p("FOUND",void 0,s)),error:(u,h,m)=>new p(u,h,m),json:(u,h)=>e.asResponse?{body:h?.body||u,routerResponse:h,_flag:"json"}:u,responseHeaders:s};for(const u of t.use||[]){const h=await u({...c,returnHeaders:!0,asResponse:!1});h.response&&Object.assign(c.context,h.response),h.headers&&h.headers.forEach((m,y)=>{c.responseHeaders.set(y,m)})}return c};function le(e,t){const r=async s=>{const n=s,o=typeof e=="function"?e:t,a=await Mt(n,{options:typeof e=="function"?{}:e,path:"/"});if(!o)throw new Error("handler must be defined");const d=await o(a),c=a.responseHeaders;return n.returnHeaders?{headers:c,response:d}:d};return r.options=typeof e=="function"?{}:e,r}le.create=e=>{function t(r,s){if(typeof r=="function")return le({use:e?.use},r);if(!s)throw new Error("Middleware handler is required");return le({...r,method:"*",use:[...e?.use||[],...r.use||[]]},s)}return t};var qe=(e,t,r)=>{const s=async(...n)=>{const o=n[0]||{},i=await Mt(o,{options:t,path:e}),a=await r(i).catch(c=>{if(Ht(c)&&o.asResponse)return c;throw c}),d=i.responseHeaders;return o.asResponse?Ke(a,{headers:d}):o.returnHeaders?{headers:d,response:a}:a};return s.options=t,s.path=e,s};qe.create=e=>(t,r,s)=>qe(t,{...r,use:[...r?.use||[],...e?.use||[]]},s);var ye;(function(e){e.assertEqual=n=>n;function t(n){}e.assertIs=t;function r(n){throw new Error}e.assertNever=r,e.arrayToEnum=n=>{const o={};for(const i of n)o[i]=i;return o},e.getValidEnumValues=n=>{const o=e.objectKeys(n).filter(a=>typeof n[n[a]]!="number"),i={};for(const a of o)i[a]=n[a];return e.objectValues(i)},e.objectValues=n=>e.objectKeys(n).map(function(o){return n[o]}),e.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{const o=[];for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&o.push(i);return o},e.find=(n,o)=>{for(const i of n)if(o(i))return i},e.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&isFinite(n)&&Math.floor(n)===n;function s(n,o=" | "){return n.map(i=>typeof i=="string"?`'${i}'`:i).join(o)}e.joinValues=s,e.jsonStringifyReplacer=(n,o)=>typeof o=="bigint"?o.toString():o})(ye||(ye={}));var wt;(function(e){e.mergeShapes=(t,r)=>({...t,...r})})(wt||(wt={}));ye.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]);ye.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);var yt=class Kt extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=t}format(t){const r=t||function(o){return o.message},s={_errors:[]},n=o=>{for(const i of o.issues)if(i.code==="invalid_union")i.unionErrors.map(n);else if(i.code==="invalid_return_type")n(i.returnTypeError);else if(i.code==="invalid_arguments")n(i.argumentsError);else if(i.path.length===0)s._errors.push(r(i));else{let a=s,d=0;for(;d<i.path.length;){const c=i.path[d];d===i.path.length-1?(a[c]=a[c]||{_errors:[]},a[c]._errors.push(r(i))):a[c]=a[c]||{_errors:[]},a=a[c],d++}}};return n(this),s}static assert(t){if(!(t instanceof Kt))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ye.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=r=>r.message){const r={},s=[];for(const n of this.issues)n.path.length>0?(r[n.path[0]]=r[n.path[0]]||[],r[n.path[0]].push(t(n))):s.push(t(n));return{formErrors:s,fieldErrors:r}}get formErrors(){return this.flatten()}};yt.create=e=>new yt(e);var bt;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t?.message})(bt||(bt={}));var Et;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(Et||(Et={}));class Je extends Error{constructor(t,r){super(t),this.name="BetterAuthError",this.message=t,this.cause=r,this.stack=""}}const be=(e,t="ms")=>new Date(Date.now()+(t==="sec"?e*1e3:e));var Vs={},Hs={};const ke=Object.create(null),me=e=>Vs||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?ke:globalThis),zs=new Proxy(ke,{get(e,t){return me()[t]??ke[t]},has(e,t){const r=me();return t in r||t in ke},set(e,t,r){const s=me(!0);return s[t]=r,!0},deleteProperty(e,t){if(!t)return!1;const r=me(!0);return delete r[t],!0},ownKeys(){const e=me(!0);return Object.keys(e)}});function Ws(e){return e?e!=="false":!1}const Be=typeof process<"u"&&Hs&&"production"||"",Ms=Be==="dev"||Be==="development";Be==="test"||Ws(zs.TEST);function Re(e){return e?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}function qt(e,t,r){let s="",n=0,o=0;for(const i of e)for(n=n<<8|i,o+=8;o>=6;)o-=6,s+=t[n>>o&63];if(o>0&&(s+=t[n<<6-o&63]),r){const i=(4-s.length%4)%4;s+="=".repeat(i)}return s}function Jt(e,t){const r=new Map;for(let i=0;i<t.length;i++)r.set(t[i],i);const s=[];let n=0,o=0;for(const i of e){if(i==="=")break;const a=r.get(i);if(a===void 0)throw new Error(`Invalid Base64 character: ${i}`);n=n<<6|a,o+=6,o>=8&&(o-=8,s.push(n>>o&255))}return Uint8Array.from(s)}const Oe={encode(e,t={}){const r=Re(!1),s=typeof e=="string"?new TextEncoder().encode(e):new Uint8Array(e);return qt(s,r,t.padding??!0)},decode(e){typeof e!="string"&&(e=new TextDecoder().decode(e));const t=e.includes("-")||e.includes("_"),r=Re(t);return Jt(e,r)}},tt={encode(e,t={}){const r=Re(!0),s=typeof e=="string"?new TextEncoder().encode(e):new Uint8Array(e);return qt(s,r,t.padding??!0)},decode(e){const t=e.includes("-")||e.includes("_"),r=Re(t);return Jt(e,r)}},Ks="0123456789abcdef",St={encode:e=>{if(typeof e=="string"&&(e=new TextEncoder().encode(e)),e.byteLength===0)return"";const t=new Uint8Array(e);let r="";for(const s of t)r+=s.toString(16).padStart(2,"0");return r},decode:e=>{if(!e)return"";if(typeof e=="string"){if(e.length%2!==0)throw new Error("Invalid hexadecimal string");if(!new RegExp(`^[${Ks}]+$`).test(e))throw new Error("Invalid hexadecimal string");const t=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=parseInt(e.slice(r,r+2),16);return new TextDecoder().decode(t)}return new TextDecoder().decode(e)}},Bt=(e="SHA-256",t="none")=>{const r={importKey:async(s,n)=>se.importKey("raw",typeof s=="string"?new TextEncoder().encode(s):s,{name:"HMAC",hash:{name:e}},!1,[n]),sign:async(s,n)=>{typeof s=="string"&&(s=await r.importKey(s,"sign"));const o=await se.sign("HMAC",s,typeof n=="string"?new TextEncoder().encode(n):n);return t==="hex"?St.encode(o):t==="base64"||t==="base64url"||t==="base64urlnopad"?tt.encode(o,{padding:t!=="base64urlnopad"}):o},verify:async(s,n,o)=>(typeof s=="string"&&(s=await r.importKey(s,"verify")),t==="hex"&&(o=St.decode(o)),(t==="base64"||t==="base64url"||t==="base64urlnopad")&&(o=await Oe.decode(o)),se.verify("HMAC",s,typeof o=="string"?new TextEncoder().encode(o):o,typeof n=="string"?new TextEncoder().encode(n):n))};return r};function qs(e){function t(r,s){if(typeof s=="string"&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?Z$/.test(s)){const o=new Date(s);if(!isNaN(o.getTime()))return o}return s}try{return JSON.parse(e,t)}catch{return null}}function Js(e){try{return new URL(e).origin}catch{return null}}function Bs(e){try{return new URL(e).protocol}catch{return null}}function Ft(e){try{return new URL(e).host}catch{return e}}async function Zt(e,t){if(e.context.options.session?.cookieCache?.enabled){const s=tt.encode(JSON.stringify({session:t,expiresAt:be(e.context.authCookies.sessionData.options.maxAge||60,"sec").getTime(),signature:await Bt("SHA-256","base64urlnopad").sign(e.context.secret,JSON.stringify({...t,expiresAt:be(e.context.authCookies.sessionData.options.maxAge||60,"sec").getTime()}))}),{padding:!1});if(s.length>4093)throw new Je("Session data is too large to store in the cookie. Please disable session cookie caching or reduce the size of the session data");e.setCookie(e.context.authCookies.sessionData.name,s,e.context.authCookies.sessionData.options)}}async function F(e,t,r,s){const n=await e.getSignedCookie(e.context.authCookies.dontRememberToken.name,e.context.secret);r=r!==void 0?r:!!n;const o=e.context.authCookies.sessionToken.options,i=r?void 0:e.context.sessionConfig.expiresIn;await e.setSignedCookie(e.context.authCookies.sessionToken.name,t.session.token,e.context.secret,{...o,maxAge:i,...s}),r&&await e.setSignedCookie(e.context.authCookies.dontRememberToken.name,"true",e.context.secret,e.context.authCookies.dontRememberToken.options),await Zt(e,t),e.context.setNewSession(t),e.context.options.secondaryStorage&&await e.context.secondaryStorage?.set(t.session.token,JSON.stringify({user:t.user,session:t.session}),Math.floor((new Date(t.session.expiresAt).getTime()-Date.now())/1e3))}function ne(e,t){e.setCookie(e.context.authCookies.sessionToken.name,"",{...e.context.authCookies.sessionToken.options,maxAge:0}),e.setCookie(e.context.authCookies.sessionData.name,"",{...e.context.authCookies.sessionData.options,maxAge:0}),e.setCookie(e.context.authCookies.dontRememberToken.name,"",{...e.context.authCookies.dontRememberToken.options,maxAge:0})}var Fs=Object.defineProperty,Zs=Object.defineProperties,Gs=Object.getOwnPropertyDescriptors,_t=Object.getOwnPropertySymbols,Qs=Object.prototype.hasOwnProperty,Ys=Object.prototype.propertyIsEnumerable,At=(e,t,r)=>t in e?Fs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,X=(e,t)=>{for(var r in t||(t={}))Qs.call(t,r)&&At(e,r,t[r]);if(_t)for(var r of _t(t))Ys.call(t,r)&&At(e,r,t[r]);return e},ee=(e,t)=>Zs(e,Gs(t)),Xs=class extends Error{constructor(e,t,r){super(t||e.toString(),{cause:r}),this.status=e,this.statusText=t,this.error=r}},en=async(e,t)=>{var r,s,n,o,i,a;let d=t||{};const c={onRequest:[t?.onRequest],onResponse:[t?.onResponse],onSuccess:[t?.onSuccess],onError:[t?.onError],onRetry:[t?.onRetry]};if(!t||!t?.plugins)return{url:e,options:d,hooks:c};for(const u of t?.plugins||[]){if(u.init){const h=await((r=u.init)==null?void 0:r.call(u,e.toString(),t));d=h.options||d,e=h.url}c.onRequest.push((s=u.hooks)==null?void 0:s.onRequest),c.onResponse.push((n=u.hooks)==null?void 0:n.onResponse),c.onSuccess.push((o=u.hooks)==null?void 0:o.onSuccess),c.onError.push((i=u.hooks)==null?void 0:i.onError),c.onRetry.push((a=u.hooks)==null?void 0:a.onRetry)}return{url:e,options:d,hooks:c}},Tt=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(){return this.options.delay}},tn=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(e){return Math.min(this.options.maxDelay,this.options.baseDelay*2**e)}};function rn(e){if(typeof e=="number")return new Tt({type:"linear",attempts:e,delay:1e3});switch(e.type){case"linear":return new Tt(e);case"exponential":return new tn(e);default:throw new Error("Invalid retry strategy")}}var sn=async e=>{const t={},r=async s=>typeof s=="function"?await s():s;if(e?.auth){if(e.auth.type==="Bearer"){const s=await r(e.auth.token);if(!s)return t;t.authorization=`Bearer ${s}`}else if(e.auth.type==="Basic"){const s=r(e.auth.username),n=r(e.auth.password);if(!s||!n)return t;t.authorization=`Basic ${btoa(`${s}:${n}`)}`}else if(e.auth.type==="Custom"){const s=r(e.auth.value);if(!s)return t;t.authorization=`${r(e.auth.prefix)} ${s}`}}return t},nn=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function on(e){const t=e.headers.get("content-type"),r=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!t)return"json";const s=t.split(";").shift()||"";return nn.test(s)?"json":r.has(s)||s.startsWith("text/")?"text":"blob"}function an(e){try{return JSON.parse(e),!0}catch{return!1}}function Gt(e){if(e===void 0)return!1;const t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}function kt(e){try{return JSON.parse(e)}catch{return e}}function Rt(e){return typeof e=="function"}function cn(e){if(e?.customFetchImpl)return e.customFetchImpl;if(typeof globalThis<"u"&&Rt(globalThis.fetch))return globalThis.fetch;if(typeof window<"u"&&Rt(window.fetch))return window.fetch;throw new Error("No fetch implementation found")}async function dn(e){const t=new Headers(e?.headers),r=await sn(e);for(const[s,n]of Object.entries(r||{}))t.set(s,n);if(!t.has("content-type")){const s=ln(e?.body);s&&t.set("content-type",s)}return t}function ln(e){return Gt(e)?"application/json":null}function un(e){if(!e?.body)return null;const t=new Headers(e?.headers);if(Gt(e.body)&&!t.has("content-type")){for(const[r,s]of Object.entries(e?.body))s instanceof Date&&(e.body[r]=s.toISOString());return JSON.stringify(e.body)}return e.body}function fn(e,t){var r;if(t?.method)return t.method.toUpperCase();if(e.startsWith("@")){const s=(r=e.split("@")[1])==null?void 0:r.split("/")[0];return Yt.includes(s)?s.toUpperCase():t?.body?"POST":"GET"}return t?.body?"POST":"GET"}function hn(e,t){let r;return!e?.signal&&e?.timeout&&(r=setTimeout(()=>t?.abort(),e?.timeout)),{abortTimeout:r,clearTimeout:()=>{r&&clearTimeout(r)}}}var pn=class Qt extends Error{constructor(t,r){super(r||JSON.stringify(t,null,2)),this.issues=t,Object.setPrototypeOf(this,Qt.prototype)}};async function mn(e,t){let r=await e["~standard"].validate(t);if(r.issues)throw new pn(r.issues);return r.value}var Yt=["get","post","put","patch","delete"];function gn(e,t){let{baseURL:r,params:s,query:n}=t||{query:{},params:{},baseURL:""},o=e.startsWith("http")?e.split("/").slice(0,3).join("/"):r||"";if(e.startsWith("@")){const h=e.toString().split("@")[1].split("/")[0];Yt.includes(h)&&(e=e.replace(`@${h}/`,"/"))}o.endsWith("/")||(o+="/");let[i,a]=e.replace(o,"").split("?");const d=new URLSearchParams(a);for(const[h,m]of Object.entries(n||{}))m!=null&&d.set(h,String(m));if(s)if(Array.isArray(s)){const h=i.split("/").filter(m=>m.startsWith(":"));for(const[m,y]of h.entries()){const b=s[m];i=i.replace(y,b)}}else for(const[h,m]of Object.entries(s))i=i.replace(`:${h}`,String(m));i=i.split("/").map(encodeURIComponent).join("/"),i.startsWith("/")&&(i=i.slice(1));let c=d.toString();return c=c.length>0?`?${c}`.replace(/\+/g,"%20"):"",o.startsWith("http")?new URL(`${i}${c}`,o):`${o}${i}${c}`}var v=async(e,t)=>{var r,s,n,o,i,a,d,c;const{hooks:u,url:h,options:m}=await en(e,t),y=cn(m),b=new AbortController,A=(r=m.signal)!=null?r:b.signal,I=gn(h,m),E=un(m),T=await dn(m),g=fn(h,m);let w=ee(X({},m),{url:I,headers:T,body:E,method:g,signal:A});for(const j of u.onRequest)if(j){const D=await j(w);D instanceof Object&&(w=D)}("pipeTo"in w&&typeof w.pipeTo=="function"||typeof((s=t?.body)==null?void 0:s.pipe)=="function")&&("duplex"in w||(w.duplex="half"));const{clearTimeout:x}=hn(m,b);let S=await y(w.url,w);x();const z={response:S,request:w};for(const j of u.onResponse)if(j){const D=await j(ee(X({},z),{response:(n=t?.hookOptions)!=null&&n.cloneResponse?S.clone():S}));D instanceof Response?S=D:D instanceof Object&&(S=D.response)}if(S.ok){if(!(w.method!=="HEAD"))return{data:"",error:null};const D=on(S),J={data:"",response:S,request:w};if(D==="json"||D==="text"){const B=await S.text(),Or=await((o=w.jsonParser)!=null?o:kt)(B);J.data=Or}else J.data=await S[D]();w?.output&&w.output&&!w.disableValidation&&(J.data=await mn(w.output,J.data));for(const B of u.onSuccess)B&&await B(ee(X({},J),{response:(i=t?.hookOptions)!=null&&i.cloneResponse?S.clone():S}));return t?.throw?J.data:{data:J.data,error:null}}const he=(a=t?.jsonParser)!=null?a:kt,pe=await S.text(),dt=an(pe),De=dt?await he(pe):null,Ur={response:S,responseText:pe,request:w,error:ee(X({},De),{status:S.status,statusText:S.statusText})};for(const j of u.onError)j&&await j(ee(X({},Ur),{response:(d=t?.hookOptions)!=null&&d.cloneResponse?S.clone():S}));if(t?.retry){const j=rn(t.retry),D=(c=t.retryAttempt)!=null?c:0;if(await j.shouldAttemptRetry(D,S)){for(const B of u.onRetry)B&&await B(z);const J=j.getDelay(D);return await new Promise(B=>setTimeout(B,J)),await v(e,ee(X({},t),{retryAttempt:D+1}))}}if(t?.throw)throw new Xs(S.status,S.statusText,dt?De:pe);return{data:null,error:ee(X({},De),{status:S.status,statusText:S.statusText})}};const xe=crypto,Xt=e=>e instanceof CryptoKey,K=new TextEncoder,Y=new TextDecoder;function er(...e){const t=e.reduce((n,{length:o})=>n+o,0),r=new Uint8Array(t);let s=0;for(const n of e)r.set(n,s),s+=n.length;return r}const wn=e=>{let t=e;typeof t=="string"&&(t=K.encode(t));const r=32768,s=[];for(let n=0;n<t.length;n+=r)s.push(String.fromCharCode.apply(null,t.subarray(n,n+r)));return btoa(s.join(""))},$e=e=>wn(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),yn=e=>{const t=atob(e),r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r},Q=e=>{let t=e;t instanceof Uint8Array&&(t=Y.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return yn(t)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class U extends Error{constructor(t,r){super(t,r),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}U.code="ERR_JOSE_GENERIC";class $ extends U{constructor(t,r,s="unspecified",n="unspecified"){super(t,{cause:{claim:s,reason:n,payload:r}}),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=s,this.reason=n,this.payload=r}}$.code="ERR_JWT_CLAIM_VALIDATION_FAILED";class ve extends U{constructor(t,r,s="unspecified",n="unspecified"){super(t,{cause:{claim:s,reason:n,payload:r}}),this.code="ERR_JWT_EXPIRED",this.claim=s,this.reason=n,this.payload=r}}ve.code="ERR_JWT_EXPIRED";class tr extends U{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}}tr.code="ERR_JOSE_ALG_NOT_ALLOWED";class q extends U{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}}q.code="ERR_JOSE_NOT_SUPPORTED";class bn extends U{constructor(t="decryption operation failed",r){super(t,r),this.code="ERR_JWE_DECRYPTION_FAILED"}}bn.code="ERR_JWE_DECRYPTION_FAILED";class En extends U{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}}En.code="ERR_JWE_INVALID";class R extends U{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}}R.code="ERR_JWS_INVALID";class V extends U{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}}V.code="ERR_JWT_INVALID";class Sn extends U{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}}Sn.code="ERR_JWK_INVALID";class rt extends U{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}}rt.code="ERR_JWKS_INVALID";class st extends U{constructor(t="no applicable key found in the JSON Web Key Set",r){super(t,r),this.code="ERR_JWKS_NO_MATCHING_KEY"}}st.code="ERR_JWKS_NO_MATCHING_KEY";class rr extends U{constructor(t="multiple matching keys found in the JSON Web Key Set",r){super(t,r),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}rr.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";class sr extends U{constructor(t="request timed out",r){super(t,r),this.code="ERR_JWKS_TIMEOUT"}}sr.code="ERR_JWKS_TIMEOUT";class nr extends U{constructor(t="signature verification failed",r){super(t,r),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}nr.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";function W(e,t="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function ge(e,t){return e.name===t}function Ve(e){return parseInt(e.name.slice(4),10)}function _n(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function An(e,t){if(t.length&&!t.some(r=>e.usages.includes(r))){let r="CryptoKey does not support this operation, its usages must include ";if(t.length>2){const s=t.pop();r+=`one of ${t.join(", ")}, or ${s}.`}else t.length===2?r+=`one of ${t[0]} or ${t[1]}.`:r+=`${t[0]}.`;throw new TypeError(r)}}function Tn(e,t,...r){switch(t){case"HS256":case"HS384":case"HS512":{if(!ge(e.algorithm,"HMAC"))throw W("HMAC");const s=parseInt(t.slice(2),10);if(Ve(e.algorithm.hash)!==s)throw W(`SHA-${s}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!ge(e.algorithm,"RSASSA-PKCS1-v1_5"))throw W("RSASSA-PKCS1-v1_5");const s=parseInt(t.slice(2),10);if(Ve(e.algorithm.hash)!==s)throw W(`SHA-${s}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!ge(e.algorithm,"RSA-PSS"))throw W("RSA-PSS");const s=parseInt(t.slice(2),10);if(Ve(e.algorithm.hash)!==s)throw W(`SHA-${s}`,"algorithm.hash");break}case"EdDSA":{if(e.algorithm.name!=="Ed25519"&&e.algorithm.name!=="Ed448")throw W("Ed25519 or Ed448");break}case"Ed25519":{if(!ge(e.algorithm,"Ed25519"))throw W("Ed25519");break}case"ES256":case"ES384":case"ES512":{if(!ge(e.algorithm,"ECDSA"))throw W("ECDSA");const s=_n(t);if(e.algorithm.namedCurve!==s)throw W(s,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}An(e,r)}function or(e,t,...r){if(r=r.filter(Boolean),r.length>2){const s=r.pop();e+=`one of type ${r.join(", ")}, or ${s}.`}else r.length===2?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return t==null?e+=` Received ${t}`:typeof t=="function"&&t.name?e+=` Received function ${t.name}`:typeof t=="object"&&t!=null&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}const vt=(e,...t)=>or("Key must be ",e,...t);function ir(e,t,...r){return or(`Key for the ${e} algorithm must be `,t,...r)}const ar=e=>Xt(e)?!0:e?.[Symbol.toStringTag]==="KeyObject",Ie=["CryptoKey"],cr=(...e)=>{const t=e.filter(Boolean);if(t.length===0||t.length===1)return!0;let r;for(const s of t){const n=Object.keys(s);if(!r||r.size===0){r=new Set(n);continue}for(const o of n){if(r.has(o))return!1;r.add(o)}}return!0};function kn(e){return typeof e=="object"&&e!==null}function H(e){if(!kn(e)||Object.prototype.toString.call(e)!=="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}const dr=(e,t)=>{if(e.startsWith("RS")||e.startsWith("PS")){const{modulusLength:r}=t.algorithm;if(typeof r!="number"||r<2048)throw new TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}};function fe(e){return H(e)&&typeof e.kty=="string"}function Rn(e){return e.kty!=="oct"&&typeof e.d=="string"}function vn(e){return e.kty!=="oct"&&typeof e.d>"u"}function In(e){return fe(e)&&e.kty==="oct"&&typeof e.k=="string"}function Un(e){let t,r;switch(e.kty){case"RSA":{switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new q('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},r=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},r=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new q('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(e.alg){case"Ed25519":t={name:"Ed25519"},r=e.d?["sign"]:["verify"];break;case"EdDSA":t={name:e.crv},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new q('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new q('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}const lr=async e=>{if(!e.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:t,keyUsages:r}=Un(e),s=[t,e.ext??!1,e.key_ops??r],n={...e};return delete n.alg,delete n.use,xe.subtle.importKey("jwk",n,...s)},ur=e=>Q(e);let ie,ae;const fr=e=>e?.[Symbol.toStringTag]==="KeyObject",Ue=async(e,t,r,s,n=!1)=>{let o=e.get(t);if(o?.[s])return o[s];const i=await lr({...r,alg:s});return n&&Object.freeze(t),o?o[s]=i:e.set(t,{[s]:i}),i},On=(e,t)=>{if(fr(e)){let r=e.export({format:"jwk"});return delete r.d,delete r.dp,delete r.dq,delete r.p,delete r.q,delete r.qi,r.k?ur(r.k):(ae||(ae=new WeakMap),Ue(ae,e,r,t))}return fe(e)?e.k?Q(e.k):(ae||(ae=new WeakMap),Ue(ae,e,e,t,!0)):e},xn=(e,t)=>{if(fr(e)){let r=e.export({format:"jwk"});return r.k?ur(r.k):(ie||(ie=new WeakMap),Ue(ie,e,r,t))}return fe(e)?e.k?Q(e.k):(ie||(ie=new WeakMap),Ue(ie,e,e,t,!0)):e},It={normalizePublicKey:On,normalizePrivateKey:xn};async function nt(e,t){if(!H(e))throw new TypeError("JWK must be an object");switch(t||(t=e.alg),e.kty){case"oct":if(typeof e.k!="string"||!e.k)throw new TypeError('missing "k" (Key Value) Parameter value');return Q(e.k);case"RSA":if("oth"in e&&e.oth!==void 0)throw new q('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return lr({...e,alg:t});default:throw new q('Unsupported "kty" (Key Type) Parameter value')}}const ce=e=>e?.[Symbol.toStringTag],Fe=(e,t,r)=>{if(t.use!==void 0&&t.use!=="sig")throw new TypeError("Invalid key for this operation, when present its use must be sig");if(t.key_ops!==void 0&&t.key_ops.includes?.(r)!==!0)throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${r}`);if(t.alg!==void 0&&t.alg!==e)throw new TypeError(`Invalid key for this operation, when present its alg must be ${e}`);return!0},Dn=(e,t,r,s)=>{if(!(t instanceof Uint8Array)){if(s&&fe(t)){if(In(t)&&Fe(e,t,r))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!ar(t))throw new TypeError(ir(e,t,...Ie,"Uint8Array",s?"JSON Web Key":null));if(t.type!=="secret")throw new TypeError(`${ce(t)} instances for symmetric algorithms must be of type "secret"`)}},Nn=(e,t,r,s)=>{if(s&&fe(t))switch(r){case"sign":if(Rn(t)&&Fe(e,t,r))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(vn(t)&&Fe(e,t,r))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!ar(t))throw new TypeError(ir(e,t,...Ie,s?"JSON Web Key":null));if(t.type==="secret")throw new TypeError(`${ce(t)} instances for asymmetric algorithms must not be of type "secret"`);if(r==="sign"&&t.type==="public")throw new TypeError(`${ce(t)} instances for asymmetric algorithm signing must be of type "private"`);if(r==="decrypt"&&t.type==="public")throw new TypeError(`${ce(t)} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&r==="verify"&&t.type==="private")throw new TypeError(`${ce(t)} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&r==="encrypt"&&t.type==="private")throw new TypeError(`${ce(t)} instances for asymmetric algorithm encryption must be of type "public"`)};function hr(e,t,r,s){t.startsWith("HS")||t==="dir"||t.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(t)?Dn(t,r,s,e):Nn(t,r,s,e)}hr.bind(void 0,!1);const Ze=hr.bind(void 0,!0);function pr(e,t,r,s,n){if(n.crit!==void 0&&s?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!s||s.crit===void 0)return new Set;if(!Array.isArray(s.crit)||s.crit.length===0||s.crit.some(i=>typeof i!="string"||i.length===0))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let o;r!==void 0?o=new Map([...Object.entries(r),...t.entries()]):o=t;for(const i of s.crit){if(!o.has(i))throw new q(`Extension Header Parameter "${i}" is not recognized`);if(n[i]===void 0)throw new e(`Extension Header Parameter "${i}" is missing`);if(o.get(i)&&s[i]===void 0)throw new e(`Extension Header Parameter "${i}" MUST be integrity protected`)}return new Set(s.crit)}const Cn=(e,t)=>{if(t!==void 0&&(!Array.isArray(t)||t.some(r=>typeof r!="string")))throw new TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)};function mr(e,t){const r=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:e.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:t.namedCurve};case"Ed25519":return{name:"Ed25519"};case"EdDSA":return{name:t.name};default:throw new q(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}async function gr(e,t,r){if(r==="sign"&&(t=await It.normalizePrivateKey(t,e)),r==="verify"&&(t=await It.normalizePublicKey(t,e)),Xt(t))return Tn(t,e,r),t;if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw new TypeError(vt(t,...Ie));return xe.subtle.importKey("raw",t,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[r])}throw new TypeError(vt(t,...Ie,"Uint8Array","JSON Web Key"))}const Ln=async(e,t,r,s)=>{const n=await gr(e,t,"verify");dr(e,n);const o=mr(e,n.algorithm);try{return await xe.subtle.verify(o,n,r,s)}catch{return!1}};async function jn(e,t,r){if(!H(e))throw new R("Flattened JWS must be an object");if(e.protected===void 0&&e.header===void 0)throw new R('Flattened JWS must have either of the "protected" or "header" members');if(e.protected!==void 0&&typeof e.protected!="string")throw new R("JWS Protected Header incorrect type");if(e.payload===void 0)throw new R("JWS Payload missing");if(typeof e.signature!="string")throw new R("JWS Signature missing or incorrect type");if(e.header!==void 0&&!H(e.header))throw new R("JWS Unprotected Header incorrect type");let s={};if(e.protected)try{const A=Q(e.protected);s=JSON.parse(Y.decode(A))}catch{throw new R("JWS Protected Header is invalid")}if(!cr(s,e.header))throw new R("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const n={...s,...e.header},o=pr(R,new Map([["b64",!0]]),r?.crit,s,n);let i=!0;if(o.has("b64")&&(i=s.b64,typeof i!="boolean"))throw new R('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:a}=n;if(typeof a!="string"||!a)throw new R('JWS "alg" (Algorithm) Header Parameter missing or invalid');const d=r&&Cn("algorithms",r.algorithms);if(d&&!d.has(a))throw new tr('"alg" (Algorithm) Header Parameter value not allowed');if(i){if(typeof e.payload!="string")throw new R("JWS Payload must be a string")}else if(typeof e.payload!="string"&&!(e.payload instanceof Uint8Array))throw new R("JWS Payload must be a string or an Uint8Array instance");let c=!1;typeof t=="function"?(t=await t(s,e),c=!0,Ze(a,t,"verify"),fe(t)&&(t=await nt(t,a))):Ze(a,t,"verify");const u=er(K.encode(e.protected??""),K.encode("."),typeof e.payload=="string"?K.encode(e.payload):e.payload);let h;try{h=Q(e.signature)}catch{throw new R("Failed to base64url decode the signature")}if(!await Ln(a,t,h,u))throw new nr;let y;if(i)try{y=Q(e.payload)}catch{throw new R("Failed to base64url decode the payload")}else typeof e.payload=="string"?y=K.encode(e.payload):y=e.payload;const b={payload:y};return e.protected!==void 0&&(b.protectedHeader=s),e.header!==void 0&&(b.unprotectedHeader=e.header),c?{...b,key:t}:b}async function Pn(e,t,r){if(e instanceof Uint8Array&&(e=Y.decode(e)),typeof e!="string")throw new R("Compact JWS must be a string or Uint8Array");const{0:s,1:n,2:o,length:i}=e.split(".");if(i!==3)throw new R("Invalid Compact JWS");const a=await jn({payload:n,protected:s,signature:o},t,r),d={payload:a.payload,protectedHeader:a.protectedHeader};return typeof t=="function"?{...d,key:a.key}:d}const G=e=>Math.floor(e.getTime()/1e3),wr=60,yr=wr*60,ot=yr*24,$n=ot*7,Vn=ot*365.25,Hn=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,we=e=>{const t=Hn.exec(e);if(!t||t[4]&&t[1])throw new TypeError("Invalid time period format");const r=parseFloat(t[2]),s=t[3].toLowerCase();let n;switch(s){case"sec":case"secs":case"second":case"seconds":case"s":n=Math.round(r);break;case"minute":case"minutes":case"min":case"mins":case"m":n=Math.round(r*wr);break;case"hour":case"hours":case"hr":case"hrs":case"h":n=Math.round(r*yr);break;case"day":case"days":case"d":n=Math.round(r*ot);break;case"week":case"weeks":case"w":n=Math.round(r*$n);break;default:n=Math.round(r*Vn);break}return t[1]==="-"||t[4]==="ago"?-n:n},Ut=e=>e.toLowerCase().replace(/^application\//,""),zn=(e,t)=>typeof e=="string"?t.includes(e):Array.isArray(e)?t.some(Set.prototype.has.bind(new Set(e))):!1,Wn=(e,t,r={})=>{let s;try{s=JSON.parse(Y.decode(t))}catch{}if(!H(s))throw new V("JWT Claims Set must be a top-level JSON object");const{typ:n}=r;if(n&&(typeof e.typ!="string"||Ut(e.typ)!==Ut(n)))throw new $('unexpected "typ" JWT header value',s,"typ","check_failed");const{requiredClaims:o=[],issuer:i,subject:a,audience:d,maxTokenAge:c}=r,u=[...o];c!==void 0&&u.push("iat"),d!==void 0&&u.push("aud"),a!==void 0&&u.push("sub"),i!==void 0&&u.push("iss");for(const b of new Set(u.reverse()))if(!(b in s))throw new $(`missing required "${b}" claim`,s,b,"missing");if(i&&!(Array.isArray(i)?i:[i]).includes(s.iss))throw new $('unexpected "iss" claim value',s,"iss","check_failed");if(a&&s.sub!==a)throw new $('unexpected "sub" claim value',s,"sub","check_failed");if(d&&!zn(s.aud,typeof d=="string"?[d]:d))throw new $('unexpected "aud" claim value',s,"aud","check_failed");let h;switch(typeof r.clockTolerance){case"string":h=we(r.clockTolerance);break;case"number":h=r.clockTolerance;break;case"undefined":h=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:m}=r,y=G(m||new Date);if((s.iat!==void 0||c)&&typeof s.iat!="number")throw new $('"iat" claim must be a number',s,"iat","invalid");if(s.nbf!==void 0){if(typeof s.nbf!="number")throw new $('"nbf" claim must be a number',s,"nbf","invalid");if(s.nbf>y+h)throw new $('"nbf" claim timestamp check failed',s,"nbf","check_failed")}if(s.exp!==void 0){if(typeof s.exp!="number")throw new $('"exp" claim must be a number',s,"exp","invalid");if(s.exp<=y-h)throw new ve('"exp" claim timestamp check failed',s,"exp","check_failed")}if(c){const b=y-s.iat,A=typeof c=="number"?c:we(c);if(b-h>A)throw new ve('"iat" claim timestamp check failed (too far in the past)',s,"iat","check_failed");if(b<0-h)throw new $('"iat" claim timestamp check failed (it should be in the past)',s,"iat","check_failed")}return s};async function it(e,t,r){const s=await Pn(e,t,r);if(s.protectedHeader.crit?.includes("b64")&&s.protectedHeader.b64===!1)throw new V("JWTs MUST NOT use unencoded payload");const o={payload:Wn(s.protectedHeader,s.payload,r),protectedHeader:s.protectedHeader};return typeof t=="function"?{...o,key:s.key}:o}const Mn=async(e,t,r)=>{const s=await gr(e,t,"sign");dr(e,s);const n=await xe.subtle.sign(mr(e,s.algorithm),s,r);return new Uint8Array(n)};class Kn{constructor(t){if(!(t instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=t}setProtectedHeader(t){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=t,this}setUnprotectedHeader(t){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=t,this}async sign(t,r){if(!this._protectedHeader&&!this._unprotectedHeader)throw new R("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!cr(this._protectedHeader,this._unprotectedHeader))throw new R("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const s={...this._protectedHeader,...this._unprotectedHeader},n=pr(R,new Map([["b64",!0]]),r?.crit,this._protectedHeader,s);let o=!0;if(n.has("b64")&&(o=this._protectedHeader.b64,typeof o!="boolean"))throw new R('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:i}=s;if(typeof i!="string"||!i)throw new R('JWS "alg" (Algorithm) Header Parameter missing or invalid');Ze(i,t,"sign");let a=this._payload;o&&(a=K.encode($e(a)));let d;this._protectedHeader?d=K.encode($e(JSON.stringify(this._protectedHeader))):d=K.encode("");const c=er(d,K.encode("."),a),u=await Mn(i,t,c),h={signature:$e(u),payload:""};return o&&(h.payload=Y.decode(a)),this._unprotectedHeader&&(h.header=this._unprotectedHeader),this._protectedHeader&&(h.protected=Y.decode(d)),h}}class qn{constructor(t){this._flattened=new Kn(t)}setProtectedHeader(t){return this._flattened.setProtectedHeader(t),this}async sign(t,r){const s=await this._flattened.sign(t,r);if(s.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${s.protected}.${s.payload}.${s.signature}`}}function te(e,t){if(!Number.isFinite(t))throw new TypeError(`Invalid ${e} input`);return t}class Jn{constructor(t={}){if(!H(t))throw new TypeError("JWT Claims Set MUST be an object");this._payload=t}setIssuer(t){return this._payload={...this._payload,iss:t},this}setSubject(t){return this._payload={...this._payload,sub:t},this}setAudience(t){return this._payload={...this._payload,aud:t},this}setJti(t){return this._payload={...this._payload,jti:t},this}setNotBefore(t){return typeof t=="number"?this._payload={...this._payload,nbf:te("setNotBefore",t)}:t instanceof Date?this._payload={...this._payload,nbf:te("setNotBefore",G(t))}:this._payload={...this._payload,nbf:G(new Date)+we(t)},this}setExpirationTime(t){return typeof t=="number"?this._payload={...this._payload,exp:te("setExpirationTime",t)}:t instanceof Date?this._payload={...this._payload,exp:te("setExpirationTime",G(t))}:this._payload={...this._payload,exp:G(new Date)+we(t)},this}setIssuedAt(t){return typeof t>"u"?this._payload={...this._payload,iat:G(new Date)}:t instanceof Date?this._payload={...this._payload,iat:te("setIssuedAt",G(t))}:typeof t=="string"?this._payload={...this._payload,iat:te("setIssuedAt",G(new Date)+we(t))}:this._payload={...this._payload,iat:te("setIssuedAt",t)},this}}class Bn extends Jn{setProtectedHeader(t){return this._protectedHeader=t,this}async sign(t,r){const s=new qn(K.encode(JSON.stringify(this._payload)));if(s.setProtectedHeader(this._protectedHeader),Array.isArray(this._protectedHeader?.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new V("JWTs MUST NOT use unencoded payload");return s.sign(t,r)}}function Fn(e){switch(typeof e=="string"&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new q('Unsupported "alg" value for a JSON Web Key Set')}}function Zn(e){return e&&typeof e=="object"&&Array.isArray(e.keys)&&e.keys.every(Gn)}function Gn(e){return H(e)}function br(e){return typeof structuredClone=="function"?structuredClone(e):JSON.parse(JSON.stringify(e))}class Qn{constructor(t){if(this._cached=new WeakMap,!Zn(t))throw new rt("JSON Web Key Set malformed");this._jwks=br(t)}async getKey(t,r){const{alg:s,kid:n}={...t,...r?.header},o=Fn(s),i=this._jwks.keys.filter(c=>{let u=o===c.kty;if(u&&typeof n=="string"&&(u=n===c.kid),u&&typeof c.alg=="string"&&(u=s===c.alg),u&&typeof c.use=="string"&&(u=c.use==="sig"),u&&Array.isArray(c.key_ops)&&(u=c.key_ops.includes("verify")),u)switch(s){case"ES256":u=c.crv==="P-256";break;case"ES256K":u=c.crv==="secp256k1";break;case"ES384":u=c.crv==="P-384";break;case"ES512":u=c.crv==="P-521";break;case"Ed25519":u=c.crv==="Ed25519";break;case"EdDSA":u=c.crv==="Ed25519"||c.crv==="Ed448";break}return u}),{0:a,length:d}=i;if(d===0)throw new st;if(d!==1){const c=new rr,{_cached:u}=this;throw c[Symbol.asyncIterator]=async function*(){for(const h of i)try{yield await Ot(u,h,s)}catch{}},c}return Ot(this._cached,a,s)}}async function Ot(e,t,r){const s=e.get(t)||e.set(t,{}).get(t);if(s[r]===void 0){const n=await nt({...t,ext:!0},r);if(n instanceof Uint8Array||n.type!=="public")throw new rt("JSON Web Key Set members must be public keys");s[r]=n}return s[r]}function xt(e){const t=new Qn(e),r=async(s,n)=>t.getKey(s,n);return Object.defineProperties(r,{jwks:{value:()=>br(t._jwks),enumerable:!0,configurable:!1,writable:!1}}),r}const Yn=async(e,t,r)=>{let s,n,o=!1;typeof AbortController=="function"&&(s=new AbortController,n=setTimeout(()=>{o=!0,s.abort()},t));const i=await fetch(e.href,{signal:s?s.signal:void 0,redirect:"manual",headers:r.headers}).catch(a=>{throw o?new sr:a});if(n!==void 0&&clearTimeout(n),i.status!==200)throw new U("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await i.json()}catch{throw new U("Failed to parse the JSON Web Key Set HTTP response as JSON")}};function Xn(){return typeof WebSocketPair<"u"||typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"||typeof EdgeRuntime<"u"&&EdgeRuntime==="vercel"}let Ge;(typeof navigator>"u"||!navigator.userAgent?.startsWith?.("Mozilla/5.0 "))&&(Ge="jose/v5.10.0");const He=Symbol();function eo(e,t){return!(typeof e!="object"||e===null||!("uat"in e)||typeof e.uat!="number"||Date.now()-e.uat>=t||!("jwks"in e)||!H(e.jwks)||!Array.isArray(e.jwks.keys)||!Array.prototype.every.call(e.jwks.keys,H))}class to{constructor(t,r){if(!(t instanceof URL))throw new TypeError("url must be an instance of URL");this._url=new URL(t.href),this._options={agent:r?.agent,headers:r?.headers},this._timeoutDuration=typeof r?.timeoutDuration=="number"?r?.timeoutDuration:5e3,this._cooldownDuration=typeof r?.cooldownDuration=="number"?r?.cooldownDuration:3e4,this._cacheMaxAge=typeof r?.cacheMaxAge=="number"?r?.cacheMaxAge:6e5,r?.[He]!==void 0&&(this._cache=r?.[He],eo(r?.[He],this._cacheMaxAge)&&(this._jwksTimestamp=this._cache.uat,this._local=xt(this._cache.jwks)))}coolingDown(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cooldownDuration:!1}fresh(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cacheMaxAge:!1}async getKey(t,r){(!this._local||!this.fresh())&&await this.reload();try{return await this._local(t,r)}catch(s){if(s instanceof st&&this.coolingDown()===!1)return await this.reload(),this._local(t,r);throw s}}async reload(){this._pendingFetch&&Xn()&&(this._pendingFetch=void 0);const t=new Headers(this._options.headers);Ge&&!t.has("User-Agent")&&(t.set("User-Agent",Ge),this._options.headers=Object.fromEntries(t.entries())),this._pendingFetch||(this._pendingFetch=Yn(this._url,this._timeoutDuration,this._options).then(r=>{this._local=xt(r),this._cache&&(this._cache.uat=Date.now(),this._cache.jwks=r),this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(r=>{throw this._pendingFetch=void 0,r})),await this._pendingFetch}}function ro(e,t){const r=new to(e,t),s=async(n,o)=>r.getKey(n,o);return Object.defineProperties(s,{coolingDown:{get:()=>r.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>r.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>r.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>!!r._pendingFetch,enumerable:!0,configurable:!1},jwks:{value:()=>r._local?.jwks(),enumerable:!0,configurable:!1,writable:!1}}),s}const Er=Q;function so(e){let t;if(typeof e=="string"){const r=e.split(".");(r.length===3||r.length===5)&&([t]=r)}else if(typeof e=="object"&&e)if("protected"in e)t=e.protected;else throw new TypeError("Token does not contain a Protected Header");try{if(typeof t!="string"||!t)throw new Error;const r=JSON.parse(Y.decode(Er(t)));if(!H(r))throw new Error;return r}catch{throw new TypeError("Invalid Token or Protected Header formatting")}}function Ee(e){if(typeof e!="string")throw new V("JWTs must use Compact JWS serialization, JWT must be a string");const{1:t,length:r}=e.split(".");if(r===5)throw new V("Only JWTs using Compact JWS serialization can be decoded");if(r!==3)throw new V("Invalid JWT");if(!t)throw new V("JWTs must contain a payload");let s;try{s=Er(t)}catch{throw new V("Failed to base64url decode the payload")}let n;try{n=JSON.parse(Y.decode(s))}catch{throw new V("Failed to parse the decoded payload as JSON")}if(!H(n))throw new V("Invalid JWT Claims Set");return n}function no(e,t){return{digest:async r=>{const s=new TextEncoder,n=typeof r=="string"?s.encode(r):r;return await se.digest(e,n)}}}async function oo(e){const t=await no("SHA-256").digest(e);return tt.encode(new Uint8Array(t),{padding:!1})}function Sr(e){return{tokenType:e.token_type,accessToken:e.access_token,refreshToken:e.refresh_token,accessTokenExpiresAt:e.expires_in?be(e.expires_in,"sec"):void 0,scopes:e?.scope?typeof e.scope=="string"?e.scope.split(" "):e.scope:[],idToken:e.id_token}}async function L({id:e,options:t,authorizationEndpoint:r,state:s,codeVerifier:n,scopes:o,claims:i,redirectURI:a,duration:d,prompt:c,accessType:u,responseType:h,display:m,loginHint:y,hd:b,responseMode:A,additionalParams:I,scopeJoiner:E}){const T=new URL(r);if(T.searchParams.set("response_type",h||"code"),T.searchParams.set("client_id",t.clientId),T.searchParams.set("state",s),T.searchParams.set("scope",o.join(E||" ")),T.searchParams.set("redirect_uri",t.redirectURI||a),d&&T.searchParams.set("duration",d),m&&T.searchParams.set("display",m),y&&T.searchParams.set("login_hint",y),c&&T.searchParams.set("prompt",c),b&&T.searchParams.set("hd",b),u&&T.searchParams.set("access_type",u),A&&T.searchParams.set("response_mode",A),n){const g=await oo(n);T.searchParams.set("code_challenge_method","S256"),T.searchParams.set("code_challenge",g)}if(i){const g=i.reduce((w,x)=>(w[x]=null,w),{});T.searchParams.set("claims",JSON.stringify({id_token:{email:null,email_verified:null,...g}}))}return I&&Object.entries(I).forEach(([g,w])=>{T.searchParams.set(g,w)}),T}async function O({code:e,codeVerifier:t,redirectURI:r,options:s,tokenEndpoint:n,authentication:o,deviceId:i}){const a=new URLSearchParams,d={"content-type":"application/x-www-form-urlencoded",accept:"application/json","user-agent":"better-auth"};if(a.set("grant_type","authorization_code"),a.set("code",e),t&&a.set("code_verifier",t),s.clientKey&&a.set("client_key",s.clientKey),i&&a.set("device_id",i),a.set("redirect_uri",s.redirectURI||r),o==="basic"){const m=btoa(`${s.clientId}:${s.clientSecret}`);d.authorization=`Basic ${m}`}else a.set("client_id",s.clientId),a.set("client_secret",s.clientSecret);const{data:c,error:u}=await v(n,{method:"POST",body:a,headers:d});if(u)throw u;return Sr(c)}async function N({refreshToken:e,options:t,tokenEndpoint:r,authentication:s,extraParams:n,grantType:o="refresh_token"}){const i=new URLSearchParams,a={"content-type":"application/x-www-form-urlencoded",accept:"application/json"};if(i.set("grant_type",o),i.set("refresh_token",e),s==="basic"){const h=btoa(`${t.clientId}:${t.clientSecret}`);a.authorization=`Basic ${h}`}else i.set("client_id",t.clientId),i.set("client_secret",t.clientSecret);if(n)for(const[h,m]of Object.entries(n))i.set(h,m);const{data:d,error:c}=await v(r,{method:"POST",body:i,headers:a});if(c)throw c;const u={accessToken:d.access_token,refreshToken:d.refresh_token,tokenType:d.token_type,scopes:d.scope?.split(" "),idToken:d.id_token};if(d.expires_in){const h=new Date;u.accessTokenExpiresAt=new Date(h.getTime()+d.expires_in*1e3)}return u}function Dt(e){switch(e){case"a-z":return"abcdefghijklmnopqrstuvwxyz";case"A-Z":return"ABCDEFGHIJKLMNOPQRSTUVWXYZ";case"0-9":return"0123456789";case"-_":return"-_";default:throw new Error(`Unsupported alphabet: ${e}`)}}function _r(...e){const t=e.map(Dt).join("");if(t.length===0)throw new Error("No valid characters provided for random string generation.");const r=t.length;return(s,...n)=>{if(s<=0)throw new Error("Length must be a positive integer.");let o=t,i=r;n.length>0&&(o=n.map(Dt).join(""),i=o.length);const a=new Uint8Array(s);Is(a);let d="";for(let c=0;c<s;c++){const u=a[c]%i;d+=o[u]}return d}}const Qe=_r("a-z","0-9","A-Z","-_"),Ye=["info","success","warn","error","debug"];function io(e,t){return Ye.indexOf(t)<=Ye.indexOf(e)}const M={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",fg:{red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m"}},ao={info:M.fg.blue,success:M.fg.green,warn:M.fg.yellow,error:M.fg.red,debug:M.fg.magenta},co=(e,t)=>{const r=new Date().toISOString();return`${M.dim}${r}${M.reset} ${ao[e]}${e.toUpperCase()}${M.reset} ${M.bright}[Better Auth]:${M.reset} ${t}`},lo=e=>{const t="error",r=(s,n,o=[])=>{if(!io(t,s))return;const i=co(s,n);{s==="error"?console.error(i,...o):s==="warn"?console.warn(i,...o):console.log(i,...o);return}};return Object.fromEntries(Ye.map(s=>[s,(...[n,...o])=>r(s,n,o)]))},re=lo(),uo=e=>{const t="https://appleid.apple.com/auth/token";return{id:"apple",name:"Apple",async createAuthorizationURL({state:r,scopes:s,redirectURI:n}){const o=e.disableDefaultScope?[]:["email","name"];return e.scope&&o.push(...e.scope),s&&o.push(...s),await L({id:"apple",options:e,authorizationEndpoint:"https://appleid.apple.com/auth/authorize",scopes:o,state:r,redirectURI:n,responseMode:"form_post"})},validateAuthorizationCode:async({code:r,codeVerifier:s,redirectURI:n})=>O({code:r,codeVerifier:s,redirectURI:n,options:e,tokenEndpoint:t}),async verifyIdToken(r,s){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(r,s);const n=so(r),{kid:o,alg:i}=n;if(!o||!i)return!1;const a=await fo(o),{payload:d}=await it(r,a,{algorithms:[i],issuer:"https://appleid.apple.com",audience:e.appBundleIdentifier||e.clientId,maxTokenAge:"1h"});return["email_verified","is_private_email"].forEach(c=>{d[c]!==void 0&&(d[c]=!!d[c])}),s&&d.nonce!==s?!1:!!d},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async r=>N({refreshToken:r,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://appleid.apple.com/auth/token"}),async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);if(!r.idToken)return null;const s=Ee(r.idToken);if(!s)return null;const n=s.user?`${s.user.name.firstName} ${s.user.name.lastName}`:s.email,o=await e.mapProfileToUser?.(s);return{user:{id:s.sub,name:n,emailVerified:!1,email:s.email,...o},data:s}},options:e}},fo=async e=>{const t="https://appleid.apple.com",r="/auth/keys",{data:s}=await v(`${t}${r}`);if(!s?.keys)throw new p("BAD_REQUEST",{message:"Keys not found"});const n=s.keys.find(o=>o.kid===e);if(!n)throw new Error(`JWK with kid ${e} not found`);return await nt(n,n.alg)},ho=e=>({id:"discord",name:"Discord",createAuthorizationURL({state:t,scopes:r,redirectURI:s}){const n=e.disableDefaultScope?[]:["identify","email"];return r&&n.push(...r),e.scope&&n.push(...e.scope),new URL(`https://discord.com/api/oauth2/authorize?scope=${n.join("+")}&response_type=code&client_id=${e.clientId}&redirect_uri=${encodeURIComponent(e.redirectURI||s)}&state=${t}&prompt=${e.prompt||"none"}`)},validateAuthorizationCode:async({code:t,redirectURI:r})=>O({code:t,redirectURI:r,options:e,tokenEndpoint:"https://discord.com/api/oauth2/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>N({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://discord.com/api/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:s}=await v("https://discord.com/api/users/@me",{headers:{authorization:`Bearer ${t.accessToken}`}});if(s)return null;if(r.avatar===null){const o=r.discriminator==="0"?Number(BigInt(r.id)>>BigInt(22))%6:parseInt(r.discriminator)%5;r.image_url=`https://cdn.discordapp.com/embed/avatars/${o}.png`}else{const o=r.avatar.startsWith("a_")?"gif":"png";r.image_url=`https://cdn.discordapp.com/avatars/${r.id}/${r.avatar}.${o}`}const n=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.global_name||r.username||"",email:r.email,emailVerified:r.verified,image:r.image_url,...n},data:r}},options:e}),po=e=>({id:"facebook",name:"Facebook",async createAuthorizationURL({state:t,scopes:r,redirectURI:s,loginHint:n}){const o=e.disableDefaultScope?[]:["email","public_profile"];return e.scope&&o.push(...e.scope),r&&o.push(...r),await L({id:"facebook",options:e,authorizationEndpoint:"https://www.facebook.com/v21.0/dialog/oauth",scopes:o,state:t,redirectURI:s,loginHint:n})},validateAuthorizationCode:async({code:t,redirectURI:r})=>O({code:t,redirectURI:r,options:e,tokenEndpoint:"https://graph.facebook.com/oauth/access_token"}),async verifyIdToken(t,r){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(t,r);if(t.split(".").length)try{const{payload:s}=await it(t,ro(new URL("https://www.facebook.com/.well-known/oauth/openid/jwks")),{algorithms:["RS256"],audience:e.clientId,issuer:"https://www.facebook.com"});return r&&s.nonce!==r?!1:!!s}catch{return!1}return!0},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>N({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://graph.facebook.com/v18.0/oauth/access_token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(t.idToken){const i=Ee(t.idToken),a={id:i.sub,name:i.name,email:i.email,picture:{data:{url:i.picture,height:100,width:100,is_silhouette:!1}}},d=await e.mapProfileToUser?.({...a,email_verified:!0});return{user:{...a,emailVerified:!0,...d},data:i}}const r=["id","name","email","picture",...e?.fields||[]],{data:s,error:n}=await v("https://graph.facebook.com/me?fields="+r.join(","),{auth:{type:"Bearer",token:t.accessToken}});if(n)return null;const o=await e.mapProfileToUser?.(s);return{user:{id:s.id,name:s.name,email:s.email,image:s.picture.data.url,emailVerified:s.email_verified,...o},data:s}},options:e}),mo=e=>{const t="https://github.com/login/oauth/access_token";return{id:"github",name:"GitHub",createAuthorizationURL({state:r,scopes:s,loginHint:n,redirectURI:o}){const i=e.disableDefaultScope?[]:["read:user","user:email"];return e.scope&&i.push(...e.scope),s&&i.push(...s),L({id:"github",options:e,authorizationEndpoint:"https://github.com/login/oauth/authorize",scopes:i,state:r,redirectURI:o,loginHint:n})},validateAuthorizationCode:async({code:r,redirectURI:s})=>O({code:r,redirectURI:s,options:e,tokenEndpoint:t}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async r=>N({refreshToken:r,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://github.com/login/oauth/token"}),async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);const{data:s,error:n}=await v("https://api.github.com/user",{headers:{"User-Agent":"better-auth",authorization:`Bearer ${r.accessToken}`}});if(n)return null;let o=!1;if(!s.email){const{data:a}=await v("https://api.github.com/user/emails",{headers:{Authorization:`Bearer ${r.accessToken}`,"User-Agent":"better-auth"}});a&&(s.email=(a.find(d=>d.primary)??a[0])?.email,o=a.find(d=>d.email===s.email)?.verified??!1)}const i=await e.mapProfileToUser?.(s);return{user:{id:s.id.toString(),name:s.name||s.login,email:s.email,image:s.avatar_url,emailVerified:o,...i},data:s}},options:e}},go=e=>({id:"google",name:"Google",async createAuthorizationURL({state:t,scopes:r,codeVerifier:s,redirectURI:n,loginHint:o,display:i}){if(!e.clientId||!e.clientSecret)throw re.error("Client Id and Client Secret is required for Google. Make sure to provide them in the options."),new Je("CLIENT_ID_AND_SECRET_REQUIRED");if(!s)throw new Je("codeVerifier is required for Google");const a=e.disableDefaultScope?[]:["email","profile","openid"];return e.scope&&a.push(...e.scope),r&&a.push(...r),await L({id:"google",options:e,authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",scopes:a,state:t,codeVerifier:s,redirectURI:n,prompt:e.prompt,accessType:e.accessType,display:i||e.display,loginHint:o,hd:e.hd})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:s})=>O({code:t,codeVerifier:r,redirectURI:s,options:e,tokenEndpoint:"https://oauth2.googleapis.com/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>N({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://www.googleapis.com/oauth2/v4/token"}),async verifyIdToken(t,r){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(t,r);const s=`https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=${t}`,{data:n}=await v(s);return n?n.aud===e.clientId&&(n.iss==="https://accounts.google.com"||n.iss==="accounts.google.com"):!1},async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.idToken)return null;const r=Ee(t.idToken),s=await e.mapProfileToUser?.(r);return{user:{id:r.sub,name:r.name,email:r.email,image:r.picture,emailVerified:r.email_verified,...s},data:r}},options:e}),wo=e=>{const t=e.tenantId||"common",r=`https://login.microsoftonline.com/${t}/oauth2/v2.0/authorize`,s=`https://login.microsoftonline.com/${t}/oauth2/v2.0/token`;return{id:"microsoft",name:"Microsoft EntraID",createAuthorizationURL(n){const o=e.disableDefaultScope?[]:["openid","profile","email","User.Read"];return e.scope&&o.push(...e.scope),n.scopes&&o.push(...o),L({id:"microsoft",options:e,authorizationEndpoint:r,state:n.state,codeVerifier:n.codeVerifier,scopes:o,redirectURI:n.redirectURI,prompt:e.prompt})},validateAuthorizationCode({code:n,codeVerifier:o,redirectURI:i}){return O({code:n,codeVerifier:o,redirectURI:i,options:e,tokenEndpoint:s})},async getUserInfo(n){if(e.getUserInfo)return e.getUserInfo(n);if(!n.idToken)return null;const o=Ee(n.idToken),i=e.profilePhotoSize||48;await v(`https://graph.microsoft.com/v1.0/me/photos/${i}x${i}/$value`,{headers:{Authorization:`Bearer ${n.accessToken}`},async onResponse(d){if(!(e.disableProfilePhoto||!d.response.ok))try{const u=await d.response.clone().arrayBuffer(),h=Oe.encode(u);o.picture=`data:image/jpeg;base64, ${h}`}catch(c){re.error(c&&typeof c=="object"&&"name"in c?c.name:"",c)}}});const a=await e.mapProfileToUser?.(o);return{user:{id:o.sub,name:o.name,email:o.email,image:o.picture,emailVerified:!0,...a},data:o}},options:e}},yo=e=>({id:"spotify",name:"Spotify",createAuthorizationURL({state:t,scopes:r,codeVerifier:s,redirectURI:n}){const o=e.disableDefaultScope?[]:["user-read-email"];return e.scope&&o.push(...e.scope),r&&o.push(...r),L({id:"spotify",options:e,authorizationEndpoint:"https://accounts.spotify.com/authorize",scopes:o,state:t,codeVerifier:s,redirectURI:n})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:s})=>O({code:t,codeVerifier:r,redirectURI:s,options:e,tokenEndpoint:"https://accounts.spotify.com/api/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>N({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://accounts.spotify.com/api/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:s}=await v("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(s)return null;const n=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.display_name,email:r.email,image:r.images[0]?.url,emailVerified:!1,...n},data:r}},options:e}),bo=e=>({id:"twitch",name:"Twitch",createAuthorizationURL({state:t,scopes:r,redirectURI:s}){const n=e.disableDefaultScope?[]:["user:read:email","openid"];return e.scope&&n.push(...e.scope),r&&n.push(...r),L({id:"twitch",redirectURI:s,options:e,authorizationEndpoint:"https://id.twitch.tv/oauth2/authorize",scopes:n,state:t,claims:e.claims||["email","email_verified","preferred_username","picture"]})},validateAuthorizationCode:async({code:t,redirectURI:r})=>O({code:t,redirectURI:r,options:e,tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>N({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const r=t.idToken;if(!r)return re.error("No idToken found in token"),null;const s=Ee(r),n=await e.mapProfileToUser?.(s);return{user:{id:s.sub,name:s.preferred_username,email:s.email,image:s.picture,emailVerified:!1,...n},data:s}},options:e}),Eo=e=>({id:"twitter",name:"Twitter",createAuthorizationURL(t){const r=e.disableDefaultScope?[]:["users.read","tweet.read","offline.access"];return e.scope&&r.push(...e.scope),t.scopes&&r.push(...t.scopes),L({id:"twitter",options:e,authorizationEndpoint:"https://x.com/i/oauth2/authorize",scopes:r,state:t.state,codeVerifier:t.codeVerifier,redirectURI:t.redirectURI})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:s})=>O({code:t,codeVerifier:r,authentication:"basic",redirectURI:s,options:e,tokenEndpoint:"https://api.x.com/2/oauth2/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>N({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://api.twitter.com/2/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:s}=await v("https://api.x.com/2/users/me?user.fields=profile_image_url",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(s)return null;const n=await e.mapProfileToUser?.(r);return{user:{id:r.data.id,name:r.data.name,email:r.data.username||null,image:r.data.profile_image_url,emailVerified:r.data.verified||!1,...n},data:r}},options:e}),So=e=>{const t="https://api.dropboxapi.com/oauth2/token";return{id:"dropbox",name:"Dropbox",createAuthorizationURL:async({state:r,scopes:s,codeVerifier:n,redirectURI:o})=>{const i=e.disableDefaultScope?[]:["account_info.read"];return e.scope&&i.push(...e.scope),s&&i.push(...s),await L({id:"dropbox",options:e,authorizationEndpoint:"https://www.dropbox.com/oauth2/authorize",scopes:i,state:r,redirectURI:o,codeVerifier:n})},validateAuthorizationCode:async({code:r,codeVerifier:s,redirectURI:n})=>await O({code:r,codeVerifier:s,redirectURI:n,options:e,tokenEndpoint:t}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async r=>N({refreshToken:r,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://api.dropbox.com/oauth2/token"}),async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);const{data:s,error:n}=await v("https://api.dropboxapi.com/2/users/get_current_account",{method:"POST",headers:{Authorization:`Bearer ${r.accessToken}`}});if(n)return null;const o=await e.mapProfileToUser?.(s);return{user:{id:s.account_id,name:s.name?.display_name,email:s.email,emailVerified:s.email_verified||!1,image:s.profile_photo_url,...o},data:s}},options:e}},_o=e=>{const t="https://www.linkedin.com/oauth/v2/authorization",r="https://www.linkedin.com/oauth/v2/accessToken";return{id:"linkedin",name:"Linkedin",createAuthorizationURL:async({state:s,scopes:n,redirectURI:o,loginHint:i})=>{const a=e.disableDefaultScope?[]:["profile","email","openid"];return e.scope&&a.push(...e.scope),n&&a.push(...n),await L({id:"linkedin",options:e,authorizationEndpoint:t,scopes:a,state:s,loginHint:i,redirectURI:o})},validateAuthorizationCode:async({code:s,redirectURI:n})=>await O({code:s,redirectURI:n,options:e,tokenEndpoint:r}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async s=>N({refreshToken:s,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:r}),async getUserInfo(s){if(e.getUserInfo)return e.getUserInfo(s);const{data:n,error:o}=await v("https://api.linkedin.com/v2/userinfo",{method:"GET",headers:{Authorization:`Bearer ${s.accessToken}`}});if(o)return null;const i=await e.mapProfileToUser?.(n);return{user:{id:n.sub,name:n.name,email:n.email,emailVerified:n.email_verified||!1,image:n.picture,...i},data:n}},options:e}},ze=(e="")=>e.split("://").map(t=>t.replace(/\/{2,}/g,"/")).join("://"),Ao=e=>{let t=e||"https://gitlab.com";return{authorizationEndpoint:ze(`${t}/oauth/authorize`),tokenEndpoint:ze(`${t}/oauth/token`),userinfoEndpoint:ze(`${t}/api/v4/user`)}},To=e=>{const{authorizationEndpoint:t,tokenEndpoint:r,userinfoEndpoint:s}=Ao(e.issuer),n="gitlab";return{id:n,name:"Gitlab",createAuthorizationURL:async({state:i,scopes:a,codeVerifier:d,loginHint:c,redirectURI:u})=>{const h=e.disableDefaultScope?[]:["read_user"];return e.scope&&h.push(...e.scope),a&&h.push(...a),await L({id:n,options:e,authorizationEndpoint:t,scopes:h,state:i,redirectURI:u,codeVerifier:d,loginHint:c})},validateAuthorizationCode:async({code:i,redirectURI:a,codeVerifier:d})=>O({code:i,redirectURI:a,options:e,codeVerifier:d,tokenEndpoint:r}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async i=>N({refreshToken:i,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://gitlab.com/oauth/token"}),async getUserInfo(i){if(e.getUserInfo)return e.getUserInfo(i);const{data:a,error:d}=await v(s,{headers:{authorization:`Bearer ${i.accessToken}`}});if(d||a.state!=="active"||a.locked)return null;const c=await e.mapProfileToUser?.(a);return{user:{id:a.id.toString(),name:a.name??a.username,email:a.email,image:a.avatar_url,emailVerified:!0,...c},data:a}},options:e}},ko=e=>({id:"tiktok",name:"TikTok",createAuthorizationURL({state:t,scopes:r,redirectURI:s}){const n=e.disableDefaultScope?[]:["user.info.profile"];return e.scope&&n.push(...e.scope),r&&n.push(...r),new URL(`https://www.tiktok.com/v2/auth/authorize?scope=${n.join(",")}&response_type=code&client_key=${e.clientKey}&client_secret=${e.clientSecret}&redirect_uri=${encodeURIComponent(e.redirectURI||s)}&state=${t}`)},validateAuthorizationCode:async({code:t,redirectURI:r})=>O({code:t,redirectURI:e.redirectURI||r,options:e,tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>N({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const r=["open_id","avatar_large_url","display_name","username"],{data:s,error:n}=await v(`https://open.tiktokapis.com/v2/user/info/?fields=${r.join(",")}`,{headers:{authorization:`Bearer ${t.accessToken}`}});return n?null:{user:{email:s.data.user.email||s.data.user.username,id:s.data.user.open_id,name:s.data.user.display_name||s.data.user.username,image:s.data.user.avatar_large_url,emailVerified:!!s.data.user.email},data:s}},options:e}),Ro=e=>({id:"reddit",name:"Reddit",createAuthorizationURL({state:t,scopes:r,redirectURI:s}){const n=e.disableDefaultScope?[]:["identity"];return e.scope&&n.push(...e.scope),r&&n.push(...r),L({id:"reddit",options:e,authorizationEndpoint:"https://www.reddit.com/api/v1/authorize",scopes:n,state:t,redirectURI:s,duration:e.duration})},validateAuthorizationCode:async({code:t,redirectURI:r})=>{const s=new URLSearchParams({grant_type:"authorization_code",code:t,redirect_uri:e.redirectURI||r}),n={"content-type":"application/x-www-form-urlencoded",accept:"text/plain","user-agent":"better-auth",Authorization:`Basic ${Oe.encode(`${e.clientId}:${e.clientSecret}`)}`},{data:o,error:i}=await v("https://www.reddit.com/api/v1/access_token",{method:"POST",headers:n,body:s.toString()});if(i)throw i;return Sr(o)},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>N({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://www.reddit.com/api/v1/access_token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:s}=await v("https://oauth.reddit.com/api/v1/me",{headers:{Authorization:`Bearer ${t.accessToken}`,"User-Agent":"better-auth"}});if(s)return null;const n=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.name,email:r.oauth_client_id,emailVerified:r.has_verified_email,image:r.icon_img?.split("?")[0],...n},data:r}},options:e}),vo=e=>({id:"roblox",name:"Roblox",createAuthorizationURL({state:t,scopes:r,redirectURI:s}){const n=e.disableDefaultScope?[]:["openid","profile"];return e.scope&&n.push(...e.scope),r&&n.push(...r),new URL(`https://apis.roblox.com/oauth/v1/authorize?scope=${n.join("+")}&response_type=code&client_id=${e.clientId}&redirect_uri=${encodeURIComponent(e.redirectURI||s)}&state=${t}&prompt=${e.prompt||"select_account+consent"}`)},validateAuthorizationCode:async({code:t,redirectURI:r})=>O({code:t,redirectURI:e.redirectURI||r,options:e,tokenEndpoint:"https://apis.roblox.com/oauth/v1/token",authentication:"post"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>N({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://apis.roblox.com/oauth/v1/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:s}=await v("https://apis.roblox.com/oauth/v1/userinfo",{headers:{authorization:`Bearer ${t.accessToken}`}});if(s)return null;const n=await e.mapProfileToUser?.(r);return{user:{id:r.sub,name:r.nickname||r.preferred_username||"",image:r.picture,email:r.preferred_username||null,emailVerified:!0,...n},data:{...r}}},options:e}),Io=e=>({id:"vk",name:"VK",async createAuthorizationURL({state:t,scopes:r,codeVerifier:s,redirectURI:n}){const o=e.disableDefaultScope?[]:["email","phone"];return e.scope&&o.push(...e.scope),r&&o.push(...r),L({id:"vk",options:e,authorizationEndpoint:"https://id.vk.com/authorize",scopes:o,state:t,redirectURI:n,codeVerifier:s})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:s,deviceId:n})=>O({code:t,codeVerifier:r,redirectURI:e.redirectURI||s,options:e,deviceId:n,tokenEndpoint:"https://id.vk.com/oauth2/auth"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>N({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://id.vk.com/oauth2/auth"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.accessToken)return null;const r=new URLSearchParams({access_token:t.accessToken,client_id:e.clientId}).toString(),{data:s,error:n}=await v("https://id.vk.com/oauth2/user_info",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r});return n||!s.user.email?null:{user:{id:s.user.user_id,first_name:s.user.first_name,last_name:s.user.last_name,email:s.user.email,image:s.user.avatar,emailVerified:!!s.user.email,birthday:s.user.birthday,sex:s.user.sex},data:s}},options:e}),Uo=e=>({id:"kick",name:"Kick",createAuthorizationURL({state:t,scopes:r,redirectURI:s,codeVerifier:n}){const o=e.disableDefaultScope?[]:["user:read"];return e.scope&&o.push(...e.scope),r&&o.push(...r),L({id:"kick",redirectURI:s,options:e,authorizationEndpoint:"https://id.kick.com/oauth/authorize",scopes:o,codeVerifier:n,state:t})},async validateAuthorizationCode({code:t,redirectURI:r,codeVerifier:s}){return O({code:t,redirectURI:r,options:e,tokenEndpoint:"https://id.kick.com/oauth/token",codeVerifier:s})},async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:s}=await v("https://api.kick.com/public/v1/users",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(s)return null;const n=r.data[0],o=await e.mapProfileToUser?.(n);return{user:{id:n.user_id,name:n.name,email:n.email,image:n.profile_picture,emailVerified:!0,...o},data:n}},options:e}),Oo={apple:uo,discord:ho,facebook:po,github:mo,microsoft:wo,google:go,spotify:yo,twitch:bo,twitter:Eo,dropbox:So,kick:Uo,linkedin:_o,gitlab:To,tiktok:ko,reddit:Ro,roblox:vo,vk:Io},Ar=Object.keys(Oo),xo=f.enum(Ar,{description:"OAuth2 provider to use"});async function Tr(e,t){const r=e.body?.callbackURL||e.context.options.baseURL;if(!r)throw new p("BAD_REQUEST",{message:"callbackURL is required"});const s=Qe(128),n=Qe(32),o=JSON.stringify({callbackURL:r,codeVerifier:s,errorURL:e.body?.errorCallbackURL,newUserURL:e.body?.newUserCallbackURL,link:t,expiresAt:Date.now()+10*60*1e3,requestSignUp:e.body?.requestSignUp}),i=new Date;i.setMinutes(i.getMinutes()+10);const a=await e.context.internalAdapter.createVerificationValue({value:o,identifier:n,expiresAt:i});if(!a)throw e.context.logger.error("Unable to create verification. Make sure the database adapter is properly working and there is a verification table in the database"),new p("INTERNAL_SERVER_ERROR",{message:"Unable to create verification"});return{state:a.identifier,codeVerifier:s}}async function Do(e){const t=e.query.state||e.body.state,r=await e.context.internalAdapter.findVerificationValue(t);if(!r)throw e.context.logger.error("State Mismatch. Verification not found",{state:t}),e.redirect(`${e.context.baseURL}/error?error=please_restart_the_process`);const s=f.object({callbackURL:f.string(),codeVerifier:f.string(),errorURL:f.string().optional(),newUserURL:f.string().optional(),expiresAt:f.number(),link:f.object({email:f.string(),userId:f.coerce.string()}).optional(),requestSignUp:f.boolean().optional()}).parse(JSON.parse(r.value));if(s.errorURL||(s.errorURL=`${e.context.baseURL}/error`),s.expiresAt<Date.now())throw await e.context.internalAdapter.deleteVerificationValue(r.id),e.redirect(`${e.context.baseURL}/error?error=please_restart_the_process`);return await e.context.internalAdapter.deleteVerificationValue(r.id),s}const No=e=>_r("a-z","A-Z","0-9")(e);f.object({id:f.string(),providerId:f.string(),accountId:f.string(),userId:f.coerce.string(),accessToken:f.string().nullish(),refreshToken:f.string().nullish(),idToken:f.string().nullish(),accessTokenExpiresAt:f.date().nullish(),refreshTokenExpiresAt:f.date().nullish(),scope:f.string().nullish(),password:f.string().nullish(),createdAt:f.date().default(()=>new Date),updatedAt:f.date().default(()=>new Date)});f.object({id:f.string(),email:f.string().transform(e=>e.toLowerCase()),emailVerified:f.boolean().default(!1),name:f.string(),image:f.string().nullish(),createdAt:f.date().default(()=>new Date),updatedAt:f.date().default(()=>new Date)});f.object({id:f.string(),userId:f.coerce.string(),expiresAt:f.date(),createdAt:f.date().default(()=>new Date),updatedAt:f.date().default(()=>new Date),token:f.string(),ipAddress:f.string().nullish(),userAgent:f.string().nullish()});f.object({id:f.string(),value:f.string(),createdAt:f.date().default(()=>new Date),updatedAt:f.date().default(()=>new Date),expiresAt:f.date(),identifier:f.string(),nonce:f.string().nullish()});async function Co(e,t,r=3600){return await new Bn(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(Math.floor(Date.now()/1e3)+r).sign(new TextEncoder().encode(t))}const We=new Map,Lo=new TextEncoder,jo={decode:(e,t="utf-8")=>(We.has(t)||We.set(t,new TextDecoder(t)),We.get(t).decode(e)),encode:Lo.encode},kr=le(async()=>({})),Se=le.create({use:[kr,le(async()=>({}))]}),k=qe.create({use:[kr]});function Xe(e){return e==="-"||e==="^"||e==="$"||e==="+"||e==="."||e==="("||e===")"||e==="|"||e==="["||e==="]"||e==="{"||e==="}"||e==="*"||e==="?"||e==="\\"?`\\${e}`:e}function Po(e){let t="";for(let r=0;r<e.length;r++)t+=Xe(e[r]);return t}function Rr(e,t=!0){if(Array.isArray(e))return`(?:${e.map(u=>`^${Rr(u,t)}$`).join("|")})`;let r="",s="",n=".";t===!0?(r="/",s="[/\\\\]",n="[^/\\\\]"):t&&(r=t,s=Po(r),s.length>1?(s=`(?:${s})`,n=`((?!${s}).)`):n=`[^${s}]`);let o=t?`${s}+?`:"",i=t?`${s}*?`:"",a=t?e.split(r):[e],d="";for(let c=0;c<a.length;c++){let u=a[c],h=a[c+1],m="";if(!(!u&&c>0)){if(t&&(c===a.length-1?m=i:h!=="**"?m=o:m=""),t&&u==="**"){m&&(d+=c===0?"":m,d+=`(?:${n}*?${m})*?`);continue}for(let y=0;y<u.length;y++){let b=u[y];b==="\\"?y<u.length-1&&(d+=Xe(u[y+1]),y++):b==="?"?d+=n:b==="*"?d+=`${n}*?`:d+=Xe(b)}d+=m}}return d}function $o(e,t){if(typeof t!="string")throw new TypeError(`Sample must be a string, but ${typeof t} given`);return e.test(t)}function vr(e,t){if(typeof e!="string"&&!Array.isArray(e))throw new TypeError(`The first argument must be a single pattern string or an array of patterns, but ${typeof e} given`);if((typeof t=="string"||typeof t=="boolean")&&(t={separator:t}),arguments.length===2&&!(typeof t>"u"||typeof t=="object"&&t!==null&&!Array.isArray(t)))throw new TypeError(`The second argument must be an options object or a string/boolean separator, but ${typeof t} given`);if(t=t||{},t.separator==="\\")throw new Error("\\ is not a valid separator because it is used for escaping. Try setting the separator to `true` instead");let r=Rr(e,t.separator),s=new RegExp(`^${r}$`,t.flags),n=$o.bind(null,s);return n.options=t,n.pattern=e,n.regexp=s,n}Se(async e=>{if(e.request?.method!=="POST"||!e.request)return;const{body:t,query:r,context:s}=e,n=e.headers?.get("origin")||e.headers?.get("referer")||"",o=t?.callbackURL||r?.callbackURL,i=t?.redirectTo,a=t?.errorCallbackURL,d=t?.newUserCallbackURL,c=Array.isArray(s.options.trustedOrigins)?s.trustedOrigins:[...s.trustedOrigins,...await s.options.trustedOrigins?.(e.request)||[]],u=e.headers?.has("cookie"),h=(y,b)=>{if(y.startsWith("/"))return!1;if(b.includes("*"))return vr(b)(Ft(y));const A=Bs(y);return A==="http:"||A==="https:"||!A?b===Js(y):y.startsWith(b)},m=(y,b)=>{if(!y)return;if(!c.some(I=>h(y,I)||y?.startsWith("/")&&b!=="origin"&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/]*(?:\?[\w\-.\+/=&%]*)?$/.test(y)))throw e.context.logger.error(`Invalid ${b}: ${y}`),e.context.logger.info(`If it's a valid URL, please add ${y} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${c}`),new p("FORBIDDEN",{message:`Invalid ${b}`})};u&&!e.context.options.advanced?.disableCSRFCheck&&m(n,"origin"),o&&m(o,"callbackURL"),i&&m(i,"redirectURL"),a&&m(a,"errorCallbackURL"),d&&m(d,"newUserCallbackURL")});const at=e=>Se(async t=>{if(!t.request)return;const{context:r}=t,s=e(t),n=Array.isArray(r.options.trustedOrigins)?r.trustedOrigins:[...r.trustedOrigins,...await r.options.trustedOrigins?.(t.request)||[]],o=(d,c)=>d.startsWith("/")?!1:c.includes("*")?vr(c)(Ft(d)):d.startsWith(c),i=(d,c)=>{if(!d)return;if(!n.some(h=>o(d,h)||d?.startsWith("/")&&c!=="origin"&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/]*(?:\?[\w\-.\+/=&%]*)?$/.test(d)))throw t.context.logger.error(`Invalid ${c}: ${d}`),t.context.logger.info(`If it's a valid URL, please add ${d} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${n}`),new p("FORBIDDEN",{message:`Invalid ${c}`})},a=Array.isArray(s)?s:[s];for(const d of a)i(d,"callbackURL")}),ct={isAction:!1},_={USER_NOT_FOUND:"User not found",FAILED_TO_CREATE_SESSION:"Failed to create session",FAILED_TO_GET_SESSION:"Failed to get session",INVALID_PASSWORD:"Invalid password",INVALID_EMAIL:"Invalid email",INVALID_EMAIL_OR_PASSWORD:"Invalid email or password",PROVIDER_NOT_FOUND:"Provider not found",INVALID_TOKEN:"invalid token",ID_TOKEN_NOT_SUPPORTED:"id_token not supported",FAILED_TO_GET_USER_INFO:"Failed to get user info",USER_EMAIL_NOT_FOUND:"User email not found",EMAIL_NOT_VERIFIED:"Email not verified",PASSWORD_TOO_SHORT:"Password too short",PASSWORD_TOO_LONG:"Password too long",USER_ALREADY_EXISTS:"User already exists",CREDENTIAL_ACCOUNT_NOT_FOUND:"Credential account not found",SESSION_EXPIRED:"Session expired. Re-authenticate to perform this action.",FAILED_TO_UNLINK_LAST_ACCOUNT:"You can't unlink your last account",ACCOUNT_NOT_FOUND:"Account not found"},Vo=()=>k("/get-session",{method:"GET",query:f.optional(f.object({disableCookieCache:f.optional(f.boolean({description:"Disable cookie cache and fetch session from database"}).or(f.string().transform(e=>e==="true"))).optional(),disableRefresh:f.boolean({description:"Disable session refresh. Useful for checking session status, without updating the session"}).or(f.string().transform(e=>e==="true")).optional()})),requireHeaders:!0,metadata:{openapi:{description:"Get the current session",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{session:{type:"object",$ref:"#/components/schemas/Session"},user:{type:"object",$ref:"#/components/schemas/User"}}}}}}}}}},async e=>{try{const t=await e.getSignedCookie(e.context.authCookies.sessionToken.name,e.context.secret);if(!t)return null;const r=e.getCookie(e.context.authCookies.sessionData.name),s=r?qs(jo.decode(Oe.decode(r))):null;if(s&&!await Bt("SHA-256","base64urlnopad").verify(e.context.secret,JSON.stringify({...s.session,expiresAt:s.expiresAt}),s.signature))return ne(e),e.json(null);const n=await e.getSignedCookie(e.context.authCookies.dontRememberToken.name,e.context.secret);if(s?.session&&e.context.options.session?.cookieCache?.enabled&&!e.query?.disableCookieCache){const u=s.session;if(s.expiresAt<Date.now()||u.session.expiresAt<new Date){const m=e.context.authCookies.sessionData.name;e.setCookie(m,"",{maxAge:0})}else return e.json(u)}const o=await e.context.internalAdapter.findSession(t);if(e.context.session=o,!o||o.session.expiresAt<new Date)return ne(e),o&&await e.context.internalAdapter.deleteSession(o.session.token),e.json(null);if(n||e.query?.disableRefresh)return e.json(o);const i=e.context.sessionConfig.expiresIn,a=e.context.sessionConfig.updateAge;if(o.session.expiresAt.valueOf()-i*1e3+a*1e3<=Date.now()){const u=await e.context.internalAdapter.updateSession(o.session.token,{expiresAt:be(e.context.sessionConfig.expiresIn,"sec")});if(!u)return ne(e),e.json(null,{status:401});const h=(u.expiresAt.valueOf()-Date.now())/1e3;return await F(e,{session:u,user:o.user},!1,{maxAge:h}),e.json({session:u,user:o.user})}return await Zt(e,o),e.json(o)}catch(t){throw e.context.logger.error("INTERNAL_SERVER_ERROR",t),new p("INTERNAL_SERVER_ERROR",{message:_.FAILED_TO_GET_SESSION})}}),oe=async(e,t)=>{if(e.context.session)return e.context.session;const r=await Vo()({...e,asResponse:!1,headers:e.headers,returnHeaders:!1,query:{...t,...e.query}}).catch(s=>null);return e.context.session=r,r},Z=Se(async e=>{const t=await oe(e);if(!t?.session)throw new p("UNAUTHORIZED");return{session:t}});Se(async e=>{const t=await oe(e);if(!t?.session&&(e.request||e.headers))throw new p("UNAUTHORIZED");return{session:t}});const Ho=Se(async e=>{const t=await oe(e);if(!t?.session)throw new p("UNAUTHORIZED");if(e.context.sessionConfig.freshAge===0)return{session:t};const r=e.context.sessionConfig.freshAge,s=t.session.updatedAt?.valueOf()||t.session.createdAt.valueOf();if(!(Date.now()-s<r*1e3))throw new p("FORBIDDEN",{message:"Session is not fresh"});return{session:t}});k("/revoke-session",{method:"POST",body:f.object({token:f.string({description:"The token to revoke"})}),use:[Z],requireHeaders:!0,metadata:{openapi:{description:"Revoke a single session",requestBody:{content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"}},required:["token"]}}}}}}},async e=>{const t=e.body.token,r=await e.context.internalAdapter.findSession(t);if(!r)throw new p("BAD_REQUEST",{message:"Session not found"});if(r.session.userId!==e.context.session.user.id)throw new p("UNAUTHORIZED");try{await e.context.internalAdapter.deleteSession(t)}catch(s){throw e.context.logger.error(s&&typeof s=="object"&&"name"in s?s.name:"",s),new p("INTERNAL_SERVER_ERROR")}return e.json({status:!0})});k("/revoke-sessions",{method:"POST",use:[Z],requireHeaders:!0,metadata:{openapi:{description:"Revoke all sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}},required:["status"]}}}}}}}},async e=>{try{await e.context.internalAdapter.deleteSessions(e.context.session.user.id)}catch(t){throw e.context.logger.error(t&&typeof t=="object"&&"name"in t?t.name:"",t),new p("INTERNAL_SERVER_ERROR")}return e.json({status:!0})});k("/revoke-other-sessions",{method:"POST",requireHeaders:!0,use:[Z],metadata:{openapi:{description:"Revoke all other sessions for the user except the current one",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async e=>{const t=e.context.session;if(!t.user)throw new p("UNAUTHORIZED");const n=(await e.context.internalAdapter.listSessions(t.user.id)).filter(o=>o.expiresAt>new Date).filter(o=>o.token!==e.context.session.session.token);return await Promise.all(n.map(o=>e.context.internalAdapter.deleteSession(o.token))),e.json({status:!0})});async function ue(e,t,r,s=3600){return await Co({email:t.toLowerCase(),updateTo:r},e,s)}async function zo(e,t){if(!e.context.options.emailVerification?.sendVerificationEmail)throw e.context.logger.error("Verification email isn't enabled."),new p("BAD_REQUEST",{message:"Verification email isn't enabled"});const r=await ue(e.context.secret,t.email,void 0,e.context.options.emailVerification?.expiresIn),s=`${e.context.baseURL}/verify-email?token=${r}&callbackURL=${e.body.callbackURL||"/"}`;await e.context.options.emailVerification.sendVerificationEmail({user:t,url:s,token:r},e.request)}k("/send-verification-email",{method:"POST",body:f.object({email:f.string({description:"The email to send the verification email to"}).email(),callbackURL:f.string({description:"The URL to use for email verification callback"}).optional()}),metadata:{openapi:{description:"Send a verification email to the user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{email:{type:"string",description:"The email to send the verification email to"},callbackURL:{type:"string",description:"The URL to use for email verification callback"}},required:["email"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async e=>{if(!e.context.options.emailVerification?.sendVerificationEmail)throw e.context.logger.error("Verification email isn't enabled."),new p("BAD_REQUEST",{message:"Verification email isn't enabled"});const{email:t}=e.body,r=await e.context.internalAdapter.findUserByEmail(t);if(!r)throw new p("BAD_REQUEST",{message:_.USER_NOT_FOUND});return await zo(e,r.user),e.json({status:!0})});k("/verify-email",{method:"GET",query:f.object({token:f.string({description:"The token to verify the email"}),callbackURL:f.string({description:"The URL to redirect to after email verification"}).optional()}),use:[at(e=>e.query.callbackURL)],metadata:{openapi:{description:"Verify the email of the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",ref:"#/components/schemas/User"},status:{type:"boolean"}},required:["user","status"]}}}}}}}},async e=>{function t(a){throw e.query.callbackURL?e.query.callbackURL.includes("?")?e.redirect(`${e.query.callbackURL}&error=${a}`):e.redirect(`${e.query.callbackURL}?error=${a}`):new p("UNAUTHORIZED",{message:a})}const{token:r}=e.query;let s;try{s=await it(r,new TextEncoder().encode(e.context.secret),{algorithms:["HS256"]})}catch(a){return a instanceof ve?t("token_expired"):t("invalid_token")}const o=f.object({email:f.string().email(),updateTo:f.string().optional()}).parse(s.payload),i=await e.context.internalAdapter.findUserByEmail(o.email);if(!i)return t("user_not_found");if(o.updateTo){const a=await oe(e);if(!a){if(e.query.callbackURL)throw e.redirect(`${e.query.callbackURL}?error=unauthorized`);return t("unauthorized")}if(a.user.email!==o.email){if(e.query.callbackURL)throw e.redirect(`${e.query.callbackURL}?error=unauthorized`);return t("unauthorized")}const d=await e.context.internalAdapter.updateUserByEmail(o.email,{email:o.updateTo,emailVerified:!1},e),c=await ue(e.context.secret,o.updateTo);if(await e.context.options.emailVerification?.sendVerificationEmail?.({user:d,url:`${e.context.baseURL}/verify-email?token=${c}&callbackURL=${e.query.callbackURL||"/"}`,token:c},e.request),await F(e,{session:a.session,user:{...a.user,email:o.updateTo,emailVerified:!1}}),e.query.callbackURL)throw e.redirect(e.query.callbackURL);return e.json({status:!0,user:{id:d.id,email:d.email,name:d.name,image:d.image,emailVerified:d.emailVerified,createdAt:d.createdAt,updatedAt:d.updatedAt}})}if(await e.context.options.emailVerification?.onEmailVerification?.(i.user,e.request),await e.context.internalAdapter.updateUserByEmail(o.email,{emailVerified:!0},e),e.context.options.emailVerification?.autoSignInAfterVerification){const a=await oe(e);if(!a||a.user.email!==o.email){const d=await e.context.internalAdapter.createSession(i.user.id,e.request);if(!d)throw new p("INTERNAL_SERVER_ERROR",{message:"Failed to create session"});await F(e,{session:d,user:{...i.user,emailVerified:!0}})}else await F(e,{session:a.session,user:{...a.user,emailVerified:!0}})}if(e.query.callbackURL)throw e.redirect(e.query.callbackURL);return e.json({status:!0,user:null})});async function Ir(e,{userInfo:t,account:r,callbackURL:s,disableSignUp:n}){const o=await e.context.internalAdapter.findOAuthUser(t.email.toLowerCase(),r.accountId,r.providerId).catch(c=>{throw re.error(`Better auth was unable to query your database.
Error: `,c),e.redirect(`${e.context.baseURL}/error?error=internal_server_error`)});let i=o?.user,a=!i;if(o){const c=o.accounts.find(u=>u.providerId===r.providerId);if(c){const u=Object.fromEntries(Object.entries({accessToken:r.accessToken,idToken:r.idToken,refreshToken:r.refreshToken,accessTokenExpiresAt:r.accessTokenExpiresAt,refreshTokenExpiresAt:r.refreshTokenExpiresAt,scope:r.scope}).filter(([h,m])=>m!==void 0));Object.keys(u).length>0&&await e.context.internalAdapter.updateAccount(c.id,u,e)}else{if(!e.context.options.account?.accountLinking?.trustedProviders?.includes(r.providerId)&&!t.emailVerified||e.context.options.account?.accountLinking?.enabled===!1)return Ms&&re.warn(`User already exist but account isn't linked to ${r.providerId}. To read more about how account linking works in Better Auth see https://www.better-auth.com/docs/concepts/users-accounts#account-linking.`),{error:"account not linked",data:null};try{await e.context.internalAdapter.linkAccount({providerId:r.providerId,accountId:t.id.toString(),userId:o.user.id,accessToken:r.accessToken,idToken:r.idToken,refreshToken:r.refreshToken,accessTokenExpiresAt:r.accessTokenExpiresAt,refreshTokenExpiresAt:r.refreshTokenExpiresAt,scope:r.scope},e)}catch(m){return re.error("Unable to link account",m),{error:"unable to link account",data:null}}}}else{if(n)return{error:"signup disabled",data:null,isRegister:!1};try{if(i=await e.context.internalAdapter.createOAuthUser({...t,email:t.email.toLowerCase(),id:void 0},{accessToken:r.accessToken,idToken:r.idToken,refreshToken:r.refreshToken,accessTokenExpiresAt:r.accessTokenExpiresAt,refreshTokenExpiresAt:r.refreshTokenExpiresAt,scope:r.scope,providerId:r.providerId,accountId:t.id.toString()},e).then(c=>c?.user),!t.emailVerified&&i&&e.context.options.emailVerification?.sendOnSignUp){const c=await ue(e.context.secret,i.email,void 0,e.context.options.emailVerification?.expiresIn),u=`${e.context.baseURL}/verify-email?token=${c}&callbackURL=${s}`;await e.context.options.emailVerification?.sendVerificationEmail?.({user:i,url:u,token:c},e.request)}}catch(c){return re.error(c),c instanceof p?{error:c.message,data:null,isRegister:!1}:{error:"unable to create user",data:null,isRegister:!1}}}if(!i)return{error:"unable to create user",data:null,isRegister:!1};const d=await e.context.internalAdapter.createSession(i.id,e.request);return d?{data:{session:d,user:i},error:null,isRegister:a}:{error:"unable to create session",data:null,isRegister:!1}}k("/sign-in/social",{method:"POST",body:f.object({callbackURL:f.string({description:"Callback URL to redirect to after the user has signed in"}).optional(),newUserCallbackURL:f.string().optional(),errorCallbackURL:f.string({description:"Callback URL to redirect to if an error happens"}).optional(),provider:xo,disableRedirect:f.boolean({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional(),idToken:f.optional(f.object({token:f.string({description:"ID token from the provider"}),nonce:f.string({description:"Nonce used to generate the token"}).optional(),accessToken:f.string({description:"Access token from the provider"}).optional(),refreshToken:f.string({description:"Refresh token from the provider"}).optional(),expiresAt:f.number({description:"Expiry date of the token"}).optional()}),{description:"ID token from the provider to sign in the user with id token"}),scopes:f.array(f.string(),{description:"Array of scopes to request from the provider. This will override the default scopes passed."}).optional(),requestSignUp:f.boolean({description:"Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider"}).optional(),loginHint:f.string({description:"The login hint to use for the authorization code request"}).optional()}),metadata:{openapi:{description:"Sign in with a social provider",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"},user:{type:"object",ref:"#/components/schemas/User"},url:{type:"string"},redirect:{type:"boolean"}},required:["redirect"]}}}}}}}},async e=>{const t=e.context.socialProviders.find(o=>o.id===e.body.provider);if(!t)throw e.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:e.body.provider}),new p("NOT_FOUND",{message:_.PROVIDER_NOT_FOUND});if(e.body.idToken){if(!t.verifyIdToken)throw e.context.logger.error("Provider does not support id token verification",{provider:e.body.provider}),new p("NOT_FOUND",{message:_.ID_TOKEN_NOT_SUPPORTED});const{token:o,nonce:i}=e.body.idToken;if(!await t.verifyIdToken(o,i))throw e.context.logger.error("Invalid id token",{provider:e.body.provider}),new p("UNAUTHORIZED",{message:_.INVALID_TOKEN});const d=await t.getUserInfo({idToken:o,accessToken:e.body.idToken.accessToken,refreshToken:e.body.idToken.refreshToken});if(!d||!d?.user)throw e.context.logger.error("Failed to get user info",{provider:e.body.provider}),new p("UNAUTHORIZED",{message:_.FAILED_TO_GET_USER_INFO});if(!d.user.email)throw e.context.logger.error("User email not found",{provider:e.body.provider}),new p("UNAUTHORIZED",{message:_.USER_EMAIL_NOT_FOUND});const c=await Ir(e,{userInfo:{email:d.user.email,id:d.user.id,name:d.user.name||"",image:d.user.image,emailVerified:d.user.emailVerified||!1},account:{providerId:t.id,accountId:d.user.id,accessToken:e.body.idToken.accessToken},disableSignUp:t.disableImplicitSignUp&&!e.body.requestSignUp||t.disableSignUp});if(c.error)throw new p("UNAUTHORIZED",{message:c.error});return await F(e,c.data),e.json({redirect:!1,token:c.data.session.token,url:void 0,user:{id:c.data.user.id,email:c.data.user.email,name:c.data.user.name,image:c.data.user.image,emailVerified:c.data.user.emailVerified,createdAt:c.data.user.createdAt,updatedAt:c.data.user.updatedAt}})}const{codeVerifier:r,state:s}=await Tr(e),n=await t.createAuthorizationURL({state:s,codeVerifier:r,redirectURI:`${e.context.baseURL}/callback/${t.id}`,scopes:e.body.scopes,loginHint:e.body.loginHint});return e.json({url:n.toString(),redirect:!e.body.disableRedirect})});k("/sign-in/email",{method:"POST",body:f.object({email:f.string({description:"Email of the user"}),password:f.string({description:"Password of the user"}),callbackURL:f.string({description:"Callback URL to use as a redirect for email verification"}).optional(),rememberMe:f.boolean({description:"If this is false, the session will not be remembered. Default is `true`."}).default(!0).optional()}),metadata:{openapi:{description:"Sign in with email and password",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"},user:{type:"object",ref:"#/components/schemas/User"},url:{type:"string"},redirect:{type:"boolean"}},required:["token","user","redirect"]}}}}}}}},async e=>{if(!e.context.options?.emailAndPassword?.enabled)throw e.context.logger.error("Email and password is not enabled. Make sure to enable it in the options on you `auth.ts` file. Check `https://better-auth.com/docs/authentication/email-password` for more!"),new p("BAD_REQUEST",{message:"Email and password is not enabled"});const{email:t,password:r}=e.body;if(!f.string().email().safeParse(t).success)throw new p("BAD_REQUEST",{message:_.INVALID_EMAIL});const n=await e.context.internalAdapter.findUserByEmail(t,{includeAccounts:!0});if(!n)throw await e.context.password.hash(r),e.context.logger.error("User not found",{email:t}),new p("UNAUTHORIZED",{message:_.INVALID_EMAIL_OR_PASSWORD});const o=n.accounts.find(c=>c.providerId==="credential");if(!o)throw e.context.logger.error("Credential account not found",{email:t}),new p("UNAUTHORIZED",{message:_.INVALID_EMAIL_OR_PASSWORD});const i=o?.password;if(!i)throw e.context.logger.error("Password not found",{email:t}),new p("UNAUTHORIZED",{message:_.INVALID_EMAIL_OR_PASSWORD});if(!await e.context.password.verify({hash:i,password:r}))throw e.context.logger.error("Invalid password"),new p("UNAUTHORIZED",{message:_.INVALID_EMAIL_OR_PASSWORD});if(e.context.options?.emailAndPassword?.requireEmailVerification&&!n.user.emailVerified){if(!e.context.options?.emailVerification?.sendVerificationEmail)throw new p("FORBIDDEN",{message:_.EMAIL_NOT_VERIFIED});const c=await ue(e.context.secret,n.user.email,void 0,e.context.options.emailVerification?.expiresIn),u=`${e.context.baseURL}/verify-email?token=${c}&callbackURL=${e.body.callbackURL||"/"}`;throw await e.context.options.emailVerification.sendVerificationEmail({user:n.user,url:u,token:c},e.request),new p("FORBIDDEN",{message:_.EMAIL_NOT_VERIFIED})}const d=await e.context.internalAdapter.createSession(n.user.id,e.headers,e.body.rememberMe===!1);if(!d)throw e.context.logger.error("Failed to create session"),new p("UNAUTHORIZED",{message:_.FAILED_TO_CREATE_SESSION});return await F(e,{session:d,user:n.user},e.body.rememberMe===!1),e.json({redirect:!!e.body.callbackURL,token:d.token,url:e.body.callbackURL,user:{id:n.user.id,email:n.user.email,name:n.user.name,image:n.user.image,emailVerified:n.user.emailVerified,createdAt:n.user.createdAt,updatedAt:n.user.updatedAt}})});const Ae=f.object({code:f.string().optional(),error:f.string().optional(),device_id:f.string().optional(),error_description:f.string().optional(),state:f.string().optional()});k("/callback/:id",{method:["GET","POST"],body:Ae.optional(),query:Ae.optional(),metadata:ct},async e=>{let t;const r=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`;try{if(e.method==="GET")t=Ae.parse(e.query);else if(e.method==="POST")t=Ae.parse(e.body);else throw new Error("Unsupported method")}catch(S){throw e.context.logger.error("INVALID_CALLBACK_REQUEST",S),e.redirect(`${r}?error=invalid_callback_request`)}const{code:s,error:n,state:o,error_description:i,device_id:a}=t;if(n)throw e.redirect(`${r}?error=${n}&error_description=${i}`);if(!o)throw e.context.logger.error("State not found",n),e.redirect(`${r}?error=state_not_found`);const{codeVerifier:d,callbackURL:c,link:u,errorURL:h,newUserURL:m,requestSignUp:y}=await Do(e);function b(S){let z=h||c||r;throw z.includes("?")?z=`${z}&error=${S}`:z=`${z}?error=${S}`,e.redirect(z)}if(!s)throw e.context.logger.error("Code not found"),b("no_code");const A=e.context.socialProviders.find(S=>S.id===e.params.id);if(!A)throw e.context.logger.error("Oauth provider with id",e.params.id,"not found"),b("oauth_provider_not_found");let I;try{I=await A.validateAuthorizationCode({code:s,codeVerifier:d,deviceId:a,redirectURI:`${e.context.baseURL}/callback/${A.id}`})}catch(S){throw e.context.logger.error("",S),b("invalid_code")}const E=await A.getUserInfo(I).then(S=>S?.user);if(!E)return e.context.logger.error("Unable to get user info"),b("unable_to_get_user_info");if(!E.email)return e.context.logger.error("Provider did not return email. This could be due to misconfiguration in the provider settings."),b("email_not_found");if(!c)throw e.context.logger.error("No callback URL found"),b("no_callback_url");if(u){const S=await e.context.internalAdapter.findAccount(E.id);if(S&&S.userId.toString()!==u.userId.toString())return b("account_already_linked_to_different_user");if(!await e.context.internalAdapter.createAccount({userId:u.userId,providerId:A.id,accountId:E.id,...I,scope:I.scopes?.join(",")},e))return b("unable_to_link_account");let he;try{he=c.toString()}catch{he=c}throw e.redirect(he)}const T=await Ir(e,{userInfo:{...E,email:E.email,name:E.name||E.email},account:{providerId:A.id,accountId:E.id,...I,scope:I.scopes?.join(",")},callbackURL:c,disableSignUp:A.disableImplicitSignUp&&!y||A.options?.disableSignUp});if(T.error)return e.context.logger.error(T.error.split(" ").join("_")),b(T.error.split(" ").join("_"));const{session:g,user:w}=T.data;await F(e,{session:g,user:w});let x;try{x=(T.isRegister&&m||c).toString()}catch{x=T.isRegister&&m||c}throw e.redirect(x)});k("/sign-out",{method:"POST",requireHeaders:!0,metadata:{openapi:{description:"Sign out the current user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async e=>{const t=await e.getSignedCookie(e.context.authCookies.sessionToken.name,e.context.secret);if(!t)throw ne(e),new p("BAD_REQUEST",{message:_.FAILED_TO_GET_SESSION});return await e.context.internalAdapter.deleteSession(t),ne(e),e.json({success:!0})});function Nt(e,t,r){const s=t?new URL(t,e.baseURL):new URL(`${e.baseURL}/error`);return r&&Object.entries(r).forEach(([n,o])=>s.searchParams.set(n,o)),s.href}function Wo(e,t,r){const s=new URL(t,e.baseURL);return r&&Object.entries(r).forEach(([n,o])=>s.searchParams.set(n,o)),s.href}k("/forget-password",{method:"POST",body:f.object({email:f.string({description:"The email address of the user to send a password reset email to"}).email(),redirectTo:f.string({description:"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"}).optional()}),metadata:{openapi:{description:"Send a password reset email to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async e=>{if(!e.context.options.emailAndPassword?.sendResetPassword)throw e.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!"),new p("BAD_REQUEST",{message:"Reset password isn't enabled"});const{email:t,redirectTo:r}=e.body,s=await e.context.internalAdapter.findUserByEmail(t,{includeAccounts:!0});if(!s)return e.context.logger.error("Reset Password: User not found",{email:t}),e.json({status:!0});const n=60*60*1,o=be(e.context.options.emailAndPassword.resetPasswordTokenExpiresIn||n,"sec"),i=No(24);await e.context.internalAdapter.createVerificationValue({value:s.user.id.toString(),identifier:`reset-password:${i}`,expiresAt:o});const a=`${e.context.baseURL}/reset-password/${i}?callbackURL=${r}`;return await e.context.options.emailAndPassword.sendResetPassword({user:s.user,url:a,token:i},e.request),e.json({status:!0})});k("/reset-password/:token",{method:"GET",query:f.object({callbackURL:f.string({description:"The URL to redirect the user to reset their password"})}),use:[at(e=>e.query.callbackURL)],metadata:{openapi:{description:"Redirects the user to the callback URL with the token",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"}}}}}}}}}},async e=>{const{token:t}=e.params,{callbackURL:r}=e.query;if(!t||!r)throw e.redirect(Nt(e.context,r,{error:"INVALID_TOKEN"}));const s=await e.context.internalAdapter.findVerificationValue(`reset-password:${t}`);throw!s||s.expiresAt<new Date?e.redirect(Nt(e.context,r,{error:"INVALID_TOKEN"})):e.redirect(Wo(e.context,r,{token:t}))});k("/reset-password",{method:"POST",query:f.object({token:f.string().optional()}).optional(),body:f.object({newPassword:f.string({description:"The new password to set"}),token:f.string({description:"The token to reset the password"}).optional()}),metadata:{openapi:{description:"Reset the password for a user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async e=>{const t=e.body.token||e.query?.token;if(!t)throw new p("BAD_REQUEST",{message:_.INVALID_TOKEN});const{newPassword:r}=e.body,s=e.context.password?.config.minPasswordLength,n=e.context.password?.config.maxPasswordLength;if(r.length<s)throw new p("BAD_REQUEST",{message:_.PASSWORD_TOO_SHORT});if(r.length>n)throw new p("BAD_REQUEST",{message:_.PASSWORD_TOO_LONG});const o=`reset-password:${t}`,i=await e.context.internalAdapter.findVerificationValue(o);if(!i||i.expiresAt<new Date)throw new p("BAD_REQUEST",{message:_.INVALID_TOKEN});const a=i.value,d=await e.context.password.hash(r);return(await e.context.internalAdapter.findAccounts(a)).find(h=>h.providerId==="credential")?(await e.context.internalAdapter.updatePassword(a,d,e),await e.context.internalAdapter.deleteVerificationValue(i.id),e.json({status:!0})):(await e.context.internalAdapter.createAccount({userId:a,providerId:"credential",password:d,accountId:a},e),await e.context.internalAdapter.deleteVerificationValue(i.id),e.json({status:!0}))});k("/change-password",{method:"POST",body:f.object({newPassword:f.string({description:"The new password to set"}),currentPassword:f.string({description:"The current password"}),revokeOtherSessions:f.boolean({description:"Revoke all other sessions"}).optional()}),use:[Z],metadata:{openapi:{description:"Change the password of the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{description:"The user object",$ref:"#/components/schemas/User"}}}}}}}}}},async e=>{const{newPassword:t,currentPassword:r,revokeOtherSessions:s}=e.body,n=e.context.session,o=e.context.password.config.minPasswordLength;if(t.length<o)throw e.context.logger.error("Password is too short"),new p("BAD_REQUEST",{message:_.PASSWORD_TOO_SHORT});const i=e.context.password.config.maxPasswordLength;if(t.length>i)throw e.context.logger.error("Password is too long"),new p("BAD_REQUEST",{message:_.PASSWORD_TOO_LONG});const d=(await e.context.internalAdapter.findAccounts(n.user.id)).find(m=>m.providerId==="credential"&&m.password);if(!d||!d.password)throw new p("BAD_REQUEST",{message:_.CREDENTIAL_ACCOUNT_NOT_FOUND});const c=await e.context.password.hash(t);if(!await e.context.password.verify({hash:d.password,password:r}))throw new p("BAD_REQUEST",{message:_.INVALID_PASSWORD});await e.context.internalAdapter.updateAccount(d.id,{password:c});let h=null;if(s){await e.context.internalAdapter.deleteSessions(n.user.id);const m=await e.context.internalAdapter.createSession(n.user.id,e.headers);if(!m)throw new p("INTERNAL_SERVER_ERROR",{message:_.FAILED_TO_GET_SESSION});await F(e,{session:m,user:n.user}),h=m.token}return e.json({token:h,user:{id:n.user.id,email:n.user.email,name:n.user.name,image:n.user.image,emailVerified:n.user.emailVerified,createdAt:n.user.createdAt,updatedAt:n.user.updatedAt}})});k("/set-password",{method:"POST",body:f.object({newPassword:f.string()}),metadata:{SERVER_ONLY:!0},use:[Z]},async e=>{const{newPassword:t}=e.body,r=e.context.session,s=e.context.password.config.minPasswordLength;if(t.length<s)throw e.context.logger.error("Password is too short"),new p("BAD_REQUEST",{message:_.PASSWORD_TOO_SHORT});const n=e.context.password.config.maxPasswordLength;if(t.length>n)throw e.context.logger.error("Password is too long"),new p("BAD_REQUEST",{message:_.PASSWORD_TOO_LONG});const i=(await e.context.internalAdapter.findAccounts(r.user.id)).find(d=>d.providerId==="credential"&&d.password),a=await e.context.password.hash(t);if(!i)return await e.context.internalAdapter.linkAccount({userId:r.user.id,providerId:"credential",accountId:r.user.id,password:a},e),e.json({status:!0});throw new p("BAD_REQUEST",{message:"user already has a password"})});k("/delete-user",{method:"POST",use:[Z],body:f.object({callbackURL:f.string().optional(),password:f.string().optional(),token:f.string().optional()}),metadata:{openapi:{description:"Delete the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object"}}}}}}}},async e=>{if(!e.context.options.user?.deleteUser?.enabled)throw e.context.logger.error("Delete user is disabled. Enable it in the options",{session:e.context.session}),new p("NOT_FOUND");const t=e.context.session;if(e.body.password){const o=(await e.context.internalAdapter.findAccounts(t.user.id)).find(a=>a.providerId==="credential"&&a.password);if(!o||!o.password)throw new p("BAD_REQUEST",{message:_.CREDENTIAL_ACCOUNT_NOT_FOUND});if(!await e.context.password.verify({hash:o.password,password:e.body.password}))throw new p("BAD_REQUEST",{message:_.INVALID_PASSWORD})}else if(e.context.options.session?.freshAge){const n=t.session.createdAt.getTime(),o=e.context.options.session.freshAge;if(Date.now()-n>o)throw new p("BAD_REQUEST",{message:_.SESSION_EXPIRED})}if(e.body.token)return await Mo({...e,query:{token:e.body.token}}),e.json({success:!0,message:"User deleted"});if(e.context.options.user.deleteUser?.sendDeleteAccountVerification){const n=Qe(32,"0-9","a-z");await e.context.internalAdapter.createVerificationValue({value:t.user.id,identifier:`delete-account-${n}`,expiresAt:new Date(Date.now()+1e3*60*60*24)});const o=`${e.context.baseURL}/delete-user/callback?token=${n}&callbackURL=${e.body.callbackURL||"/"}`;return await e.context.options.user.deleteUser.sendDeleteAccountVerification({user:t.user,url:o,token:n},e.request),e.json({success:!0,message:"Verification email sent"})}const r=e.context.options.user.deleteUser?.beforeDelete;r&&await r(t.user,e.request),await e.context.internalAdapter.deleteUser(t.user.id),await e.context.internalAdapter.deleteSessions(t.user.id),await e.context.internalAdapter.deleteAccounts(t.user.id),ne(e);const s=e.context.options.user.deleteUser?.afterDelete;return s&&await s(t.user,e.request),e.json({success:!0,message:"User deleted"})});const Mo=k("/delete-user/callback",{method:"GET",query:f.object({token:f.string(),callbackURL:f.string().optional()}),use:[at(e=>e.query.callbackURL)]},async e=>{if(!e.context.options.user?.deleteUser?.enabled)throw e.context.logger.error("Delete user is disabled. Enable it in the options"),new p("NOT_FOUND");const t=await oe(e);if(!t)throw new p("NOT_FOUND",{message:_.FAILED_TO_GET_USER_INFO});const r=await e.context.internalAdapter.findVerificationValue(`delete-account-${e.query.token}`);if(!r||r.expiresAt<new Date)throw new p("NOT_FOUND",{message:_.INVALID_TOKEN});if(r.value!==t.user.id)throw new p("NOT_FOUND",{message:_.INVALID_TOKEN});const s=e.context.options.user.deleteUser?.beforeDelete;s&&await s(t.user,e.request),await e.context.internalAdapter.deleteUser(t.user.id),await e.context.internalAdapter.deleteSessions(t.user.id),await e.context.internalAdapter.deleteAccounts(t.user.id),await e.context.internalAdapter.deleteVerificationValue(r.id),ne(e);const n=e.context.options.user.deleteUser?.afterDelete;if(n&&await n(t.user,e.request),e.query.callbackURL)throw e.redirect(e.query.callbackURL||"/");return e.json({success:!0,message:"User deleted"})});k("/change-email",{method:"POST",body:f.object({newEmail:f.string({description:"The new email to set"}).email(),callbackURL:f.string({description:"The URL to redirect to after email verification"}).optional()}),use:[Z],metadata:{openapi:{responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",ref:"#/components/schemas/User"},status:{type:"boolean"}}}}}}}}}},async e=>{if(!e.context.options.user?.changeEmail?.enabled)throw e.context.logger.error("Change email is disabled."),new p("BAD_REQUEST",{message:"Change email is disabled"});const t=e.body.newEmail.toLowerCase();if(t===e.context.session.user.email)throw e.context.logger.error("Email is the same"),new p("BAD_REQUEST",{message:"Email is the same"});if(await e.context.internalAdapter.findUserByEmail(t))throw e.context.logger.error("Email already exists"),new p("BAD_REQUEST",{message:"Couldn't update your email"});if(e.context.session.user.emailVerified!==!0){if(await e.context.internalAdapter.findUserByEmail(t))throw new p("UNPROCESSABLE_ENTITY",{message:_.USER_ALREADY_EXISTS});if(await e.context.internalAdapter.updateUserByEmail(e.context.session.user.email,{email:t},e),await F(e,{session:e.context.session.session,user:{...e.context.session.user,email:t}}),e.context.options.emailVerification?.sendVerificationEmail){const i=await ue(e.context.secret,t,void 0,e.context.options.emailVerification?.expiresIn),a=`${e.context.baseURL}/verify-email?token=${i}&callbackURL=${e.body.callbackURL||"/"}`;await e.context.options.emailVerification.sendVerificationEmail({user:{...e.context.session.user,email:t},url:a,token:i},e.request)}return e.json({status:!0})}if(!e.context.options.user.changeEmail.sendChangeEmailVerification)throw e.context.logger.error("Verification email isn't enabled."),new p("BAD_REQUEST",{message:"Verification email isn't enabled"});const s=await ue(e.context.secret,e.context.session.user.email,t,e.context.options.emailVerification?.expiresIn),n=`${e.context.baseURL}/verify-email?token=${s}&callbackURL=${e.body.callbackURL||"/"}`;return await e.context.options.user.changeEmail.sendChangeEmailVerification({user:e.context.session.user,newEmail:t,url:n,token:s},e.request),e.json({status:!0})});function Ko(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}const qo=(e="Unknown")=>`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication Error</title>
    <style>
        :root {
            --bg-color: #f8f9fa;
            --text-color: #212529;
            --accent-color: #000000;
            --error-color: #dc3545;
            --border-color: #e9ecef;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            line-height: 1.5;
        }
        .error-container {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            padding: 2.5rem;
            text-align: center;
            max-width: 90%;
            width: 400px;
        }
        h1 {
            color: var(--error-color);
            font-size: 1.75rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        p {
            margin-bottom: 1.5rem;
            color: #495057;
        }
        .btn {
            background-color: var(--accent-color);
            color: #ffffff;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            transition: all 0.3s ease;
            display: inline-block;
            font-weight: 500;
            border: 2px solid var(--accent-color);
        }
        .btn:hover {
            background-color: #131721;
        }
        .error-code {
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }
        .icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="error-container">
        <div class="icon"></div>
        <h1>Better Auth Error</h1>
        <p>We encountered an issue while processing your request. Please try again or contact the application owner if the problem persists.</p>
        <a href="/" id="returnLink" class="btn">Return to Application</a>
        <div class="error-code">Error Code: <span id="errorCode">${Ko(e)}</span></div>
    </div>
</body>
</html>`;k("/error",{method:"GET",metadata:{...ct,openapi:{description:"Displays an error page",responses:{200:{description:"Success",content:{"text/html":{schema:{type:"string"}}}}}}}},async e=>{const t=new URL(e.request?.url||"").searchParams.get("error")||"Unknown";return new Response(qo(t),{headers:{"Content-Type":"text/html"}})});k("/ok",{method:"GET",metadata:{...ct,openapi:{description:"Check if the API is working",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{ok:{type:"boolean"}}}}}}}}}},async e=>e.json({ok:!0}));k("/list-accounts",{method:"GET",use:[Z],metadata:{openapi:{description:"List all accounts linked to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{type:"object",properties:{id:{type:"string"},provider:{type:"string"},createdAt:{type:"string"},updatedAt:{type:"string"},accountId:{type:"string"},scopes:{type:"array",items:{type:"string"}}}}}}}}}}}},async e=>{const t=e.context.session,r=await e.context.internalAdapter.findAccounts(t.user.id);return e.json(r.map(s=>({id:s.id,provider:s.providerId,createdAt:s.createdAt,updatedAt:s.updatedAt,accountId:s.accountId,scopes:s.scope?.split(",")||[]})))});k("/link-social",{method:"POST",requireHeaders:!0,body:f.object({callbackURL:f.string({description:"The URL to redirect to after the user has signed in"}).optional(),provider:f.enum(Ar,{description:"The OAuth2 provider to use"})}),use:[Z],metadata:{openapi:{description:"Link a social account to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{url:{type:"string"},redirect:{type:"boolean"}},required:["url","redirect"]}}}}}}}},async e=>{const t=e.context.session,r=e.context.socialProviders.find(o=>o.id===e.body.provider);if(!r)throw e.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:e.body.provider}),new p("NOT_FOUND",{message:_.PROVIDER_NOT_FOUND});const s=await Tr(e,{userId:t.user.id,email:t.user.email}),n=await r.createAuthorizationURL({state:s.state,codeVerifier:s.codeVerifier,redirectURI:`${e.context.baseURL}/callback/${r.id}`});return e.json({url:n.toString(),redirect:!0})});k("/unlink-account",{method:"POST",body:f.object({providerId:f.string(),accountId:f.string().optional()}),use:[Ho]},async e=>{const{providerId:t,accountId:r}=e.body,s=await e.context.internalAdapter.findAccounts(e.context.session.user.id);if(s.length===1&&!e.context.options.account?.accountLinking?.allowUnlinkingAll)throw new p("BAD_REQUEST",{message:_.FAILED_TO_UNLINK_LAST_ACCOUNT});const n=s.find(o=>r?o.accountId===r&&o.providerId===t:o.providerId===t);if(!n)throw new p("BAD_REQUEST",{message:_.ACCOUNT_NOT_FOUND});return await e.context.internalAdapter.deleteAccount(n.id),e.json({status:!0})});k("/refresh-token",{method:"POST",body:f.object({providerId:f.string({description:"The provider ID for the OAuth provider"}),accountId:f.string({description:"The account ID associated with the refresh token"}).optional(),userId:f.string({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Refresh the access token using a refresh token",responses:{200:{description:"Access token refreshed successfully",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async e=>{const{providerId:t,accountId:r,userId:s}=e.body,n=e.request,o=await oe(e);if(n&&!o)throw e.error("UNAUTHORIZED");let i=o?.user?.id||s;if(!i)throw new p("BAD_REQUEST",{message:"Either userId or session is required"});const d=(await e.context.internalAdapter.findAccounts(i)).find(u=>r?u.id===r&&u.providerId===t:u.providerId===t);if(!d)throw new p("BAD_REQUEST",{message:"Account not found"});const c=e.context.socialProviders.find(u=>u.id===t);if(!c)throw new p("BAD_REQUEST",{message:`Provider ${t} not found.`});if(!c.refreshAccessToken)throw new p("BAD_REQUEST",{message:`Provider ${t} does not support token refreshing.`});try{const u=await c.refreshAccessToken(d.refreshToken);return await e.context.internalAdapter.updateAccount(d.id,{accessToken:u.accessToken,accessTokenExpiresAt:u.accessTokenExpiresAt,refreshToken:u.refreshToken,refreshTokenExpiresAt:u.refreshTokenExpiresAt}),e.json(u)}catch(u){throw new p("BAD_REQUEST",{message:"Failed to refresh access token",cause:u})}});function Jo(e){return e.charAt(0).toUpperCase()+e.slice(1)}function Bo({lead:e}){const t=fs();return l.jsxs(jr,{direction:t?"bottom":"right",children:[l.jsx(Pr,{asChild:!0,children:l.jsx(C,{variant:"link",className:"text-foreground w-fit cursor-pointer px-0 text-left",children:Jo(e.email)})}),l.jsxs($r,{className:"",children:[l.jsxs(Vr,{className:"gap-1",children:[l.jsx(Hr,{children:e.email}),l.jsx(zr,{children:"Lead Details"})]}),l.jsxs("div",{className:"flex flex-col gap-4 overflow-y-auto px-4 text-sm",children:["111",l.jsx(hs,{}),l.jsxs("form",{className:"flex flex-col gap-4",children:[l.jsxs("div",{className:"flex flex-col gap-3",children:[l.jsx(de,{htmlFor:"name",children:"Username"}),l.jsx(Te,{id:"name",defaultValue:e.email})]}),l.jsxs("div",{className:"flex flex-col gap-3",children:[l.jsx(de,{htmlFor:"email",children:"Email"}),l.jsx(Te,{id:"email",defaultValue:e.email})]}),l.jsxs("div",{className:"flex flex-col gap-3",children:[l.jsx(de,{htmlFor:"role",children:"Role"}),l.jsxs(Wr,{defaultValue:"user",children:[l.jsx(Mr,{id:"role",className:"w-full",children:l.jsx(Kr,{placeholder:"Select user role"})}),l.jsxs(qr,{children:[l.jsx(Ne,{value:"admin",children:"Administrator"}),l.jsx(Ne,{value:"editor",children:"Editor"}),l.jsx(Ne,{value:"user",children:"Regular User"})]})]})]}),l.jsxs("div",{className:"flex flex-col gap-3",children:[l.jsx(de,{htmlFor:"createdAt",children:"Registration Date"}),l.jsx(Te,{id:"createdAt",value:e.created_at?e.created_at.toLocaleString():"Unknown",disabled:!0})]})]})]}),l.jsxs(Jr,{children:[l.jsx(C,{children:"Save"}),l.jsx(Br,{asChild:!0,children:l.jsx(C,{variant:"outline",children:"Close"})})]})]})]})}function Fo({data:e}){const[t,r]=P.useState({}),[s,n]=P.useState({}),[o,i]=P.useState([]),[a,d]=P.useState([]),[c,u]=P.useState({pageIndex:0,pageSize:10}),[h,m]=P.useState(""),[y,b]=P.useState("email"),A=xr(),I=P.useMemo(()=>[{id:"select",header:({table:g})=>l.jsx("div",{className:"flex items-center justify-start pl-3",children:l.jsx(ut,{checked:g.getIsAllPageRowsSelected()||g.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:w=>g.toggleAllPageRowsSelected(!!w),"aria-label":"Select all"})}),cell:({row:g})=>l.jsx("div",{className:"flex items-center justify-start pl-3",children:l.jsx(ut,{checked:g.getIsSelected(),onCheckedChange:w=>g.toggleSelected(!!w),"aria-label":"Select row"})}),enableSorting:!1,enableHiding:!1,size:40},{accessorKey:"email",header:"Email",cell:({row:g})=>l.jsx(Bo,{lead:g.original}),enableSorting:!0,enableHiding:!1,size:160},{accessorKey:"phone",header:"Phone",cell:({row:g})=>l.jsxs("div",{className:"w-full flex items-center gap-2",children:[l.jsx(Ts,{className:"h-4 w-4 text-muted-foreground"}),g.original.phone]}),enableSorting:!0,size:120},{accessorKey:"service",header:"Service Type",cell:({row:g})=>l.jsx(Me,{variant:"outline",className:"text-muted-foreground px-1.5",children:g.original.service}),enableSorting:!0,size:120},{accessorKey:"status",header:"Status",cell:({row:g})=>{const w=g.original.status;let x="outline";return w==="pending"?x="outline":w==="contacted"?x="secondary":w==="completed"?x="default":w==="rejected"&&(x="destructive"),l.jsx(Me,{variant:x,className:"px-1.5",children:ys(w)})},enableSorting:!0,size:100},{accessorKey:"zip_code",header:"Zip Code",cell:({row:g})=>l.jsx("div",{className:"w-full",children:g.original.zip_code}),enableSorting:!0,size:80},{accessorKey:"submission_date",header:"Submission Date",cell:({row:g})=>l.jsx("div",{className:"w-full",children:g.original.submission_date?new Date(g.original.submission_date).toLocaleString():"Unknown"}),enableSorting:!0,size:160},{accessorKey:"form_source",header:"Source",cell:({row:g})=>l.jsx("div",{className:"w-full",children:g.original.form_source||"Website"}),enableSorting:!0,size:100},{id:"actions",cell:({row:g})=>l.jsxs(Le,{children:[l.jsx(je,{asChild:!0,children:l.jsxs(C,{variant:"ghost",className:"data-[state=open]:bg-muted text-muted-foreground flex size-8",size:"icon",children:[l.jsx(ps,{}),l.jsx("span",{className:"sr-only",children:"Open menu"})]})}),l.jsxs(Pe,{align:"end",className:"w-32",children:[l.jsx(_e,{onClick:()=>{},children:"View Details"}),l.jsx(_e,{onClick:()=>{lt.success("Status updated to contacted"),A.invalidateQueries({queryKey:["leads"]})},children:"Mark as Contacted"}),l.jsx(ms,{}),l.jsx(_e,{variant:"destructive",onClick:async()=>{lt.success("Record deleted"),A.invalidateQueries({queryKey:["leads"]})},children:"Delete"})]})]}),enableSorting:!1,size:44}],[A]),E=Fr({data:e,columns:I,state:{sorting:a,columnVisibility:s,rowSelection:t,columnFilters:o,pagination:c},getRowId:g=>g.id.toString(),enableRowSelection:!0,onRowSelectionChange:r,onSortingChange:d,onColumnFiltersChange:i,onColumnVisibilityChange:n,onPaginationChange:u,getCoreRowModel:es(),getFilteredRowModel:Xr(),getPaginationRowModel:Yr(),getSortedRowModel:Qr(),getFacetedRowModel:Gr(),getFacetedUniqueValues:Zr(),columnResizeMode:"onChange"}),T=P.useMemo(()=>E.getAllColumns().filter(g=>typeof g.accessorFn<"u"&&g.id!=="select"&&g.id!=="actions"),[E]);return P.useEffect(()=>{h?E.getColumn(y)?.setFilterValue(h):E.getColumn(y)?.setFilterValue("")},[h,y,E]),P.useMemo(()=>y.replace(/([A-Z])/g," $1").replace(/^./,w=>w.toUpperCase()),[y]),l.jsxs("div",{className:"flex flex-col gap-4",children:[l.jsxs("div",{className:"flex items-center justify-between gap-2 py-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"flex w-full max-w-sm items-center gap-2",children:l.jsxs("div",{className:"relative flex-1 ",children:[l.jsxs(Le,{children:[l.jsx(je,{asChild:!0,children:l.jsxs(C,{variant:"ghost",size:"icon",className:"absolute left-1 top-1/2 z-10 h-7 w-7 -translate-y-1/2 flex items-center justify-center",children:[l.jsx(Rs,{className:"text-muted-foreground h-4 w-4"}),l.jsx("span",{className:"sr-only",children:"Select search column"})]})}),l.jsxs(Pe,{className:"w-48 p-2",align:"start",children:[l.jsx("p",{className:"mb-2 text-sm font-medium px-2",children:"Select search column"}),T.map(g=>l.jsxs(_e,{className:"capitalize",onSelect:()=>b(g.id),children:[g.id.charAt(0).toUpperCase()+g.id.slice(1),g.id===y&&l.jsx(ts,{className:"ml-auto h-4 w-4"})]},g.id))]})]}),l.jsx(Te,{type:"text",placeholder:"Search leads...",className:"pl-10 h-9",value:h,onChange:g=>m(g.target.value)}),h&&l.jsxs(C,{variant:"ghost",size:"icon",className:"absolute right-0.5 top-1/2 -translate-y-1/2 h-7 w-7 flex items-center justify-center",onClick:()=>m(""),children:[l.jsx(pt,{className:"h-4 w-4"}),l.jsx("span",{className:"sr-only",children:"Clear search"})]})]})}),l.jsxs(Le,{children:[l.jsx(je,{asChild:!0,children:l.jsxs(C,{variant:"outline",size:"sm",children:[l.jsx(rs,{}),l.jsx("span",{className:"hidden lg:inline",children:"Show Columns"}),l.jsx("span",{className:"lg:hidden",children:"Cols"}),l.jsx(ss,{})]})}),l.jsx(Pe,{align:"end",className:"w-56",children:E.getAllColumns().filter(g=>typeof g.accessorFn<"u"&&g.getCanHide()).map(g=>l.jsx(gs,{className:"capitalize",checked:g.getIsVisible(),onCheckedChange:w=>g.toggleVisibility(!!w),children:g.id},g.id))})]}),E.getState().sorting.length>0&&l.jsxs(C,{variant:"outline",size:"sm",onClick:()=>d([]),className:"flex items-center gap-1",children:[l.jsx(pt,{className:"size-4"}),l.jsx("span",{children:"Clear Sort"})]})]}),l.jsx(C,{variant:"outline",size:"sm",children:"Export Data"})]}),l.jsx("div",{className:"overflow-hidden rounded-lg border",children:l.jsxs(ns,{className:"w-full table-fixed [&_th]:pl-3 [&_th]:pr-3 [&_td]:pl-3 [&_td]:pr-3",children:[l.jsx(os,{className:"bg-muted sticky top-0 z-10",children:E.getHeaderGroups().map(g=>l.jsx(Ce,{children:g.headers.map(w=>l.jsx(is,{colSpan:w.colSpan,style:{width:w.getSize()},className:"text-start",children:w.isPlaceholder?null:l.jsxs("div",{className:"flex items-center gap-1",children:[ft(w.column.columnDef.header,w.getContext()),w.column.getCanSort()&&l.jsx(C,{variant:"ghost",size:"icon",className:"size-6 ml-1",onClick:()=>w.column.toggleSorting(void 0,!0),"aria-label":`Sort by ${w.column.id}`,children:l.jsxs("div",{className:"relative flex flex-col items-center justify-center",children:[l.jsx("div",{className:`w-0 h-0 border-l-[4px] border-l-transparent border-r-[4px] border-r-transparent border-b-[6px] ${w.column.getIsSorted()==="asc"?"border-b-primary":"border-b-muted-foreground/30"} transition-colors duration-200`}),l.jsx("div",{className:`w-0 h-0 mt-[1px] border-l-[4px] border-l-transparent border-r-[4px] border-r-transparent border-t-[6px] ${w.column.getIsSorted()==="desc"?"border-t-primary":"border-t-muted-foreground/30"} transition-colors duration-200`}),E.getState().sorting.length>1&&w.column.getIsSorted()&&l.jsx("span",{className:"absolute -right-2.5 -top-0.5 text-[0.6rem] font-bold text-primary",children:E.getState().sorting.findIndex(x=>x.id===w.column.id)+1})]})})]})},w.id))},g.id))}),l.jsx(as,{children:E.getRowModel().rows?.length?E.getRowModel().rows.map(g=>l.jsx(Ce,{"data-state":g.getIsSelected()&&"selected",children:g.getVisibleCells().map(w=>l.jsx(ht,{style:{width:w.column.getSize()},className:"text-start",children:ft(w.column.columnDef.cell,w.getContext())},w.id))},g.id)):l.jsx(Ce,{children:l.jsx(ht,{colSpan:I.length,className:"h-24 text-center",children:"No data found"})})})]})}),l.jsxs("div",{className:"flex items-center justify-between px-4",children:[l.jsxs("div",{className:"text-muted-foreground hidden flex-1 text-sm lg:flex",children:["Selected ",E.getFilteredSelectedRowModel().rows.length," / Total"," ",E.getFilteredRowModel().rows.length," records"]}),l.jsxs("div",{className:"flex w-full items-center gap-8 lg:w-fit",children:[l.jsxs("div",{className:"hidden items-center gap-2 lg:flex",children:[l.jsx(de,{htmlFor:"rows-per-page",className:"text-sm font-medium",children:"Rows per page"}),l.jsxs(Ct,{value:`${E.getState().pagination.pageSize}`,onValueChange:g=>{E.setPageSize(Number(g))},children:[l.jsx(Lt,{size:"sm",className:"w-20",id:"rows-per-page",children:l.jsx(jt,{placeholder:E.getState().pagination.pageSize})}),l.jsx(Pt,{side:"top",children:[10,20,30,40,50].map(g=>l.jsx(cs,{value:`${g}`,children:g},g))})]})]}),l.jsxs("div",{className:"flex w-fit items-center justify-center text-sm font-medium",children:["Page ",E.getState().pagination.pageIndex+1," of"," ",E.getPageCount()]}),l.jsxs("div",{className:"ml-auto flex items-center gap-2 lg:ml-0",children:[l.jsxs(C,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>E.setPageIndex(0),disabled:!E.getCanPreviousPage(),children:[l.jsx("span",{className:"sr-only",children:"Go to first page"}),l.jsx(ds,{})]}),l.jsxs(C,{variant:"outline",className:"size-8",size:"icon",onClick:()=>E.previousPage(),disabled:!E.getCanPreviousPage(),children:[l.jsx("span",{className:"sr-only",children:"Go to previous page"}),l.jsx(ls,{})]}),l.jsxs(C,{variant:"outline",className:"size-8",size:"icon",onClick:()=>E.nextPage(),disabled:!E.getCanNextPage(),children:[l.jsx("span",{className:"sr-only",children:"Go to next page"}),l.jsx(ws,{})]}),l.jsxs(C,{variant:"outline",className:"hidden size-8 lg:flex",size:"icon",onClick:()=>E.setPageIndex(E.getPageCount()-1),disabled:!E.getCanNextPage(),children:[l.jsx("span",{className:"sr-only",children:"Go to last page"}),l.jsx(us,{})]})]})]})]})]})}function Zo({leads:e}){const t=[{value:"outline",label:"Users Management",content:l.jsx(Fo,{data:e})}];return l.jsx(vs,{tabs:t,defaultTab:"outline"})}const Go=async()=>{const{data:e,error:t}=await Es.from("cecila123_submissions").select("*");if(t)throw t;return e},Qo=()=>bs({queryKey:["leads"],queryFn:Go});function Yo(){const{data:e}=_s(Qo());return e?l.jsx(Zo,{leads:e}):null}const ii=function(){return l.jsx("div",{children:l.jsx(P.Suspense,{fallback:l.jsx("div",{className:"flex justify-center items-center h-48",children:l.jsx(Ss,{className:"h-8 w-8 animate-spin text-primary"})}),children:l.jsx(Yo,{})})})};export{ii as component};
